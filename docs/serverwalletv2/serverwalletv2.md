#WelcometoServerWalletv2##OverviewThev2ServerWalletenablesdeveloperstoprogrammaticallycreate,manage,andusecryptoaccountswhileCDPsecurestheprivatekeysandhandlescomplexinfrastructuremanagement.Developerscanaccessthev2ServerWalletthrougheitherthe[CDPSDK](https://github.com/coinbase/cdp-sdk)or[CDP'sRESTendpoints](/api-reference/v2/introduction).Withthev2ServerWallet,youcanexecutetokenswapsdirectlyfromyourCDPaccounts,combiningthepowerofourTradeAPIswithsecuretransactionsigning.Thisallowsyoutodiscoverthebestprices,createswapquotes,andexecutetradesinasinglecall.Thefollowingtablesummarizesthekeydifferencesbetweenv1andv2ServerWallet:|Feature|v1ServerWallet🔴|v2ServerWallet🟢||--------------------|----------------------|----------------------------------------------------------------------------||Securitymanagement|Complex|Easy||Privatekeysecurity|Developer-managed|Securedin[AWSNitroEnclaveTEE](/server-wallets/v2/introduction/security)||Authentication|Onesecretperaccount|Singlesecretforallaccounts||Networksupport|EVMonly|EVMandSolana||EVMaccountscope|SingleEVMnetwork|MultipleEVMnetworks||Transactionbatching|-|✅||Gassponsorship|-|✅||Spendpermissions|-|✅||Viemcompatibility|-|✅|##SecurekeymanagementInsteadofsecuringyourownprivatekeysorneedingtosetup[Server-Signerinfrastructure](/server-wallets/v1/concepts/server-signer),thev2ServerWalletgreatlysimplifiescryptokeymanagementbysigningallofyourtransactionswithina[TrustedExecutionEnvironment(TEE)](/server-wallets/v2/introduction/security).TheTEEensuresthatsensitivecryptographicmaterialisneverexposedtotheoutsideworld-noteventoCoinbase!<Info>TheTrustedExecutionEnvironment(TEE)providesasecureenvironmentforsigningyourtransactions,andensuresthatyourprivatekeysareneverexposedtoCoinbase,AWS,ortheoutsideworld.Readmoreinour[Securitydocumentation](/server-wallets/v2/introduction/security).</Info>###SinglesecretauthenticationInthev2ServerWallet,asingle[WalletSecret](/server-wallets/v2/introduction/security#wallet-secrets)grantsaccesstoallofyouraccountsacrossboththeEVMandSolanaecosystems.Thissinglesecretisusedforsensitivewalletoperations,suchasaccountcreationandtransactionsigning.###RotatableWalletSecretIncaseyourWalletSecretislostorcompromised,youcan[rotateyoursecret](/server-wallets/v2/using-the-wallet-api/wallet-secret-rotation)atanytime.##Multi-networksupportRatherthanlimitingusagetoasingleEVMnetwork,EVMaccountscreatedusingthev2ServerWalletarecompatibleacrossallEVMchains.Thev2ServerWalletalsosupportsSolanaaccounts,allowingyoutocreateandmanageSolanaaccountsinadditiontoEVMaccounts.##SmartaccountsThev2ServerWalletsupportsEIP-4337[smartaccounts](/server-wallets/v2/evm-features/smart-accounts),whichprovidethefollowingadvancedfeaturesviasmartcontractcalls:-[Transactionbatching](/server-wallets/v2/evm-features/smart-accounts#3-batch-calls-within-a-single-user-operation)-[Gassponsorship](/server-wallets/v2/evm-features/gas-sponsorship)-Spendpermissions(guidecomingsoon)<Accordiontitle="Moreonsmartaccounts">Alsoknownasasmartcontractaccount,a**smartaccount**isanaccountpoweredbyasmartcontractinsteadofanexternallyownedaccount(EOA).WithaCDPsmartaccount,youcan:-Sponsorgasfeessousersdon'tneedETHtointeractonchain-Batchmultiplerequestsinasingleuseroperation-Enforcecustomaccesspolicies,suchasspendlimitsortime-basedrulesImplementedusingthe[EIP-4337standard](https://eips.ethereum.org/EIPS/eip-4337),asmartaccountcanfunctionlikea"normal"account,enhancingusability,security,andflexibilityfordevelopersandend-users.</Accordion>##viemcompatibilityEVMAccountsinthev2ServerWalletcanbeuseddirectlywith[viem](https://viem.sh/)as[customaccounts](https://viem.sh/docs/accounts/local/toAccount#toaccount).Thisallowsyoutoleverageviem'swidely-usedabstractionsseamlesslywiththe[CDPSDK](https://github.com/coinbase/cdp-sdk).Refertothe[viemcompatibilityguide](/server-wallets/v2/evm-features/viem-compatibility)formoredetails.##SwapsThev2ServerWalletenablesseamlesstokenswapsandprogrammatictradingdirectlyfromyourCDPaccounts,empoweringdeveloperstobuild**automatedtradingbots**,integrateDeFiswapsinto**web3applications**,andexecutesophisticated**tradingstrategies**usingCoinbaseinfrastructure.Thispowerfulintegrationcombinesreal-timepricediscovery,competitivequotecreation,andsecuretransactionexecutionintoasingleAPIcall,whilemaintainingtheflexibilitytouseyourownwalletandnodeinfrastructureifpreferred.#ServerWalletv2:Quickstart##OverviewThev2ServerWalletallowsyoutocreate[accounts](/server-wallets/v2/introduction/accounts)onEVMcompatiblenetworksandtheSolananetwork.Inthisquickstart,youwilllearnhowto:-CreateEVMandSolanaaccounts-FundyouraccountswithtestnettokensusingCDPFaucets-Sendatransactionusing`viem`forTypescriptor`web3`forPython##PrerequisitesSetupalldependencies,exportyourkeystoenvironmentvariables,andinitializeanewprojectbeforeyoubegin.Itisassumedyouhave:-[Node.js](https://nodejs.org/en)22.x+ifusingTypescript-[Python](https://www.python.org/downloads/)3.10+ifusingPython-[Created](https://portal.cdp.coinbase.com/create-account)and[signedin](https://portal.cdp.coinbase.com/signin)toanexistingCDPaccountOnceyouhavesetuptheprerequisitedependencies,continuereadingtocreatekeystoauthenticateyourrequestsandinitializeanewproject.###CreatekeysSignintothe[CDPPortal](https://portal.cdp.coinbase.com),[createaCDPAPIkey](https://portal.cdp.coinbase.com/projects/api-keys)and[generateaWalletSecret](https://portal.cdp.coinbase.com/products/server-wallets).Keepthesevalueshandyasyouwillneedtheminthefollowingsteps.Formoreinformation,seethe[CDPAPIKeys](/get-started/authentication/cdp-api-keys#secret-api-keys)and[WalletSecret](/server-wallets/v2/introduction/security#wallet-secret)documentation.###ProjectsetupAftercreatingyourkeys,initializeanewprojectandinstantiatetheCDPclient.<TabsgroupId="programming-language"><Tabvalue="Typescript"title="Typescript"default>InitializeanewTypescriptprojectbyrunning:```bashmkdircdp-sdk-example&&cdcdp-sdk-example&&npminit-y&&npmpkgsettype="module"&&touchmain.ts&&touch.env```AddyourCDPAPIkeyandwalletsecrettothe`.env`file:```bash.envCDP_API_KEY_ID=your-api-key-idCDP_API_KEY_SECRET=your-api-key-secretCDP_WALLET_SECRET=your-wallet-secret```Now,installthe[CDPSDK](https://github.com/coinbase/cdp-sdk)andthe[dotenv](https://www.npmjs.com/package/dotenv)packages:```bashnpminstall@coinbase/cdp-sdkdotenv```Finally,in`main.ts`,instantiatetheCDPclient:```typescriptmain.tslineswrap[expandable]import{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();//InitializetheCDPclient,whichautomaticallyloads//theAPIKeyandWalletSecretfromtheenvironment//variables.constcdp=newCdpClient();```Inthisandinthefollowingexamples,youcanrunyourcodebyrunning:```bashnpxtsxmain.ts```</Tab><Tabvalue="Python"title="Python">InitializeanewPythonprojectbyrunning:```bashmkdircdp-sdk-example&&cdcdp-sdk-example&&python-mvenv.venv&&source.venv/bin/activate&&touchmain.py&&touch.env```AddyourCDPAPIkeyandwalletsecrettothe`.env`file:```bash.envCDP_API_KEY_ID=your-api-key-idCDP_API_KEY_SECRET=your-api-key-secretCDP_WALLET_SECRET=your-wallet-secret```Now,installthe[CDPSDK](https://github.com/coinbase/cdp-sdk)andthe[python-dotenv](https://pypi.org/project/python-dotenv/)package:```bashpipinstallcdp-sdkpython-dotenv```Finally,in`main.py`,instantiatetheCDPclient:```pythontitle="main.py"fromcdpimportCdpClientimportasynciofromdotenvimportload_dotenvload_dotenv()asyncdefmain():#InitializetheCDPclient,whichautomaticallyloads#theAPIKeyandWalletSecretfromtheenvironment#variables.cdp=CdpClient()awaitcdp.close()asyncio.run(main())```Inthisandinthefollowingexamples,youcanrunyourcodebyrunning:```bashpythonmain.py```</Tab></Tabs>##1.CreateanaccountThev2ServerWalletofferssupportforboth[EVMcompatibleaccountsandSolanaaccounts](/server-wallets/v2/introduction/accounts).###EVMTocreateanEVMaccount,seebelow:<CodeGroup>```typescriptmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();console.log(`CreatedEVMaccount:${account.address}`);```````pythonmain.pylineswrapimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():cdp=CdpClient()account=awaitcdp.evm.create_account()print(f"CreatedEVMaccount:{account.address}")awaitcdp.close()asyncio.run(main())````</CodeGroup>Afterrunningtheabovesnippet,youshouldseesimilaroutput:```consolelineswrapCreatedEVMaccount:0x3c0D84055994c3062819Ce8730869D0aDeA4c3Bf```<Tip>Youcanalsocreateaccountswithhuman-readablenamesandretrievethemlaterusingthe`getOrCreateAccount`method.Seethe[ManagingAccounts](/server-wallets/v2/using-the-wallet-api/managing-accounts#account-names)guideformoreinformation.</Tip>###SolanaTocreateaSolanaaccount,seebelow:<CodeGroup>```typescriptmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.solana.createAccount();console.log(`CreatedSolanaaccount:${account.address}`);```````pythonmain.pylineswrapimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():cdp=CdpClient()account=awaitcdp.solana.create_account()print(f"CreatedSolanaaccount:{account.address}")awaitcdp.close()asyncio.run(main())````</CodeGroup>Afterrunningtheabovesnippet,youshouldseesimilaroutput:```consolelineswrapCreatedSolanaaccount:2XBS6naS1v7pXEg25z43FGHnmEgEad53fmiZ9S6LPgKn```##2.FundaccountwithtestfundsAccountsdonothavefundsoncreation.Weprovidea[FaucetAPI](/faucets/introduction/welcome)toeasilyfundyourEVMaccountwithtestnettokensandSolanaaccountwithdevnettokens.<Info>Beforeyourequestfunds,ensureyoureadabout[ratelimitswhenusingCDPFaucets](/faucets/introduction/welcome#supported-assets).</Info>###EVM<CodeGroup>```typescriptmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();constfaucetResponse=awaitcdp.evm.requestFaucet({address:account.address,network:"base-sepolia",token:"eth"});console.log(`RequestedfundsfromETHfaucet:https://sepolia.basescan.org/tx/${faucetResponse.transactionHash}`);```````pythonmain.pylineswrapimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():cdp=CdpClient()account=awaitcdp.evm.create_account()faucet_hash=awaitcdp.evm.request_faucet(address=account.address,network="base-sepolia",token="eth")print(f"RequestedfundsfromETHfaucet:https://sepolia.basescan.org/tx/{faucet_hash}")awaitcdp.close()asyncio.run(main())````</CodeGroup>Afterrunningtheabove,youshouldseesimilaroutput:```consolelineswrapRequestedfundsfromETHfaucet:https://sepolia.basescan.org/tx/0x9e93a16f2ca67f35bcb1ea2933f19035ae1e71ff3100d2abc6a22ce024d085ec```###Solana<CodeGroup>```typescriptmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.solana.createAccount();const{signature}=awaitcdp.solana.requestFaucet({address:account.address,token:"sol"});console.log(`RequestedfundsfromSolanafaucet:https://explorer.solana.com/tx/${signature}?cluster=devnet`);```````pythonmain.pylineswrapimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():cdp=CdpClient()account=awaitcdp.solana.create_account()tx_signature_response=awaitcdp.solana.request_faucet(address=account.address,token="sol")print(f"RequestedfundsfromSolanafaucet:https://explorer.solana.com/tx/{tx_signature_response.transaction_signature}?cluster=devnet")awaitcdp.close()asyncio.run(main())````</CodeGroup>Afterrunningtheabove,youshouldseesimilaroutput:```consolelineswrapRequestedfundsfromSolanafaucet:https://explorer.solana.com/tx/4KEPbhkRLTg2FJNqV5bbUd6zv1TNkksxF9PDHw2FodrTha3jq2Cojn4hSKtjPWdrZiRDuYp7okRuc1oYvh3JkLuE?cluster=devnet```##3.Sendatransaction###EVM<TabsgroupId="programming-language"><Tabvalue="Typescript"title="Typescript"default>Youcansendtransactionsusingthev2ServerWallet.Notethatinordertowaitfortransactionconfirmation,youwillneedtohave`viem`installed:```bashnpminstallviem```Intheexamplebelow,we:1.CreateanewEVMaccount.2.RequestETHfromthefaucet.3.Usethev2ServerWallettosendatransaction.4.Waitfortransactionconfirmation.```typescriptmain.tslineswrap[expandable]import{CdpClient}from"@coinbase/cdp-sdk";import{http,createPublicClient,parseEther}from"viem";import{baseSepolia}from"viem/chains";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constpublicClient=createPublicClient({chain:baseSepolia,transport:http(),});//Step1:CreateanewEVMaccount.constaccount=awaitcdp.evm.createAccount();console.log("SuccessfullycreatedEVMaccount:",account.address);//Step2:RequestETHfromthefaucet.const{transactionHash:faucetTransactionHash}=awaitcdp.evm.requestFaucet({address:account.address,network:"base-sepolia",token:"eth",});constfaucetTxReceipt=awaitpublicClient.waitForTransactionReceipt({hash:faucetTransactionHash,});console.log("SuccessfullyrequestedETHfromfaucet:",faucetTxReceipt.transactionHash);//Step3:Usethev2ServerWallettosendatransaction.consttransactionResult=awaitcdp.evm.sendTransaction({address:account.address,transaction:{to:"0x0000000000000000000000000000000000000000",value:parseEther("0.000001"),},network:"base-sepolia",});//Step4:WaitforthetransactiontobeconfirmedconsttxReceipt=awaitpublicClient.waitForTransactionReceipt({hash:transactionResult.transactionHash,});console.log(`Transactionsent!Link:https://sepolia.basescan.org/tx/${transactionResult.transactionHash}`);```</Tab><Tabvalue="Python"title="Python">Youcansendtransactionsusingthev2ServerWallet.Notethatinordertowaitfortransactionconfirmation,youwillneedtohave`web3`installed:```bashpipinstallweb3```Intheexamplebelow,we:1.CreateanewEVMaccount.2.RequestETHfromthefaucet.3.Usethev2ServerWallettosendatransaction.4.Waitfortransactionconfirmation.```pythonmain.pylineswrap[expandable]importasynciofromcdpimportCdpClientfromcdp.evm_transaction_typesimportTransactionRequestEIP1559fromdotenvimportload_dotenvfromweb3importWeb3load_dotenv()w3=Web3(Web3.HTTPProvider("https://sepolia.base.org"))asyncdefmain():asyncwithCdpClient()ascdp:account=awaitcdp.evm.create_account()print(f"Createdaccount:{account.address}")faucet_hash=awaitcdp.evm.request_faucet(address=account.address,network="base-sepolia",token="eth")w3.eth.wait_for_transaction_receipt(faucet_hash)print(f"Receivedfundsfromfaucetforaddress:{account.address}")tx_hash=awaitcdp.evm.send_transaction(address=account.address,transaction=TransactionRequestEIP1559(to="0x0000000000000000000000000000000000000000",value=w3.to_wei(0.000001,"ether"),),network="base-sepolia",)print(f"Transactionsent!Link:https://sepolia.basescan.org/tx/{tx_hash}")asyncio.run(main())```</Tab></Tabs>###Solana<TabsgroupId="programming-language"><Tabvalue="Typescript"title="Typescript"default>YoucansendtransactionsonSolanausingthe[`@solana/web3.js`](https://solana.com/docs/clients/javascript)v1library.```bashnpminstall@solana/web3.js@1```Intheexamplebelow,we:1.CreateanewSolanaaccount.2.RequestSOLfromthefaucet.3.Waitforfundstobecomeavailable.4.Sendthetransactiontoaspecifiedaddress.```typescriptmain.tslineswrap[expandable]import{Connection,PublicKey,SystemProgram,Transaction,}from"@solana/web3.js";import{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constconnection=newConnection("https://api.devnet.solana.com");asyncfunctioncreateAccount(){constaccount=awaitcdp.solana.createAccount();console.log(`Createdaccount:${account.address}`);returnaccount;}asyncfunctionrequestFaucet(address:string){awaitcdp.solana.requestFaucet({address,token:"sol",});}asyncfunctionwaitForBalance(address:string){letbalance=0;letattempts=0;constmaxAttempts=30;while(balance===0&&attempts<maxAttempts){balance=awaitconnection.getBalance(newPublicKey(address));if(balance===0){console.log("Waitingforfunds...");awaitnewPromise(resolve=>setTimeout(resolve,1000));attempts++;}else{console.log("Accountfundedwith",balance/1e9,"SOL");}}if(balance===0){thrownewError("Accountnotfundedaftermultipleattempts");}}asyncfunctionsendTransaction(address:string){//Amountoflamportstosend(default:1000=0.000001SOL)constlamportsToSend=1000;constfromAddress=newPublicKey(address)consttoAddress=newPublicKey("EeVPcnRE1mhcY85wAh3uPJG1uFiTNya9dCJjNUPABXzo");const{blockhash}=awaitconnection.getLatestBlockhash();consttransaction=newTransaction();transaction.add(SystemProgram.transfer({fromPubkey:fromAddress,toPubkey:toAddress,lamports:lamportsToSend,}));transaction.recentBlockhash=blockhash;transaction.feePayer=fromAddress;constserializedTx=Buffer.from(transaction.serialize({requireAllSignatures:false})).toString("base64");const{signature:txSignature}=awaitcdp.solana.signTransaction({address,transaction:serializedTx,});constdecodedSignedTx=Buffer.from(txSignature,"base64");console.log("Sendingtransaction...");consttxSendSignature=awaitconnection.sendRawTransaction(decodedSignedTx);constlatestBlockhash=awaitconnection.getLatestBlockhash();console.log("Waitingfortransactiontobeconfirmed...");constconfirmation=awaitconnection.confirmTransaction({signature:txSendSignature,blockhash:latestBlockhash.blockhash,lastValidBlockHeight:latestBlockhash.lastValidBlockHeight,});if(confirmation.value.err){thrownewError(`Transactionfailed:${confirmation.value.err.toString()}`);}console.log(`SentSOL:https://explorer.solana.com/tx/${txSendSignature}?cluster=devnet`);}asyncfunctionmain(){constaccount=awaitcreateAccount();awaitrequestFaucet(account.address);awaitwaitForBalance(account.address);awaitsendTransaction(account.address);}main().catch(console.error)```</Tab><Tabvalue="Python"title="Python">YoucansendtransactionsonSolanausingthe[`solana`](https://solana.com/docs/clients/python)library.```bashpipinstallsolanasolders```Intheexamplebelow,we:1.CreateanewSolanaaccount.2.RequestSOLfromthefaucet.3.Waitforfundstobecomeavailable.4.Sendthetransactiontoaspecifiedaddress.```pythonmain.pylineswrap[expandable]importtimeimportbase64importasynciofromcdpimportCdpClientfromdotenvimportload_dotenvfromsolana.rpc.apiimportClientasSolanaClientfromsolana.rpc.typesimportTxOptsfromsolders.pubkeyimportPubkeyasPublicKeyfromsolders.system_programimportTransferParams,transferfromsolders.messageimportMessageload_dotenv()cdp=CdpClient()connection=SolanaClient("https://api.devnet.solana.com")asyncdefcreate_sol_account():account=awaitcdp.solana.create_account()print(f"Createdaccount:{account.address}")returnaccountasyncdefrequest_faucet(address:str):awaitcdp.solana.request_faucet(address,token="sol")asyncdefwait_for_balance(address:str):balance=0max_attempts=30attempts=0whilebalance==0andattempts<max_attempts:balance_resp=connection.get_balance(PublicKey.from_string(address))balance=balance_resp.valueifbalance==0:print("Waitingforfunds...")time.sleep(1)attempts+=1else:print(f"Accountfundedwith{balance/1e9}SOL({balance}lamports)")ifbalance==0:raiseValueError("Accountnotfundedaftermultipleattempts")asyncdefsend_transaction(address:str):#Amountoflamportstosend(default:1000=0.000001SOL)lamports_to_send=1000;from_address=PublicKey.from_string(address)to_address=PublicKey.from_string("EeVPcnRE1mhcY85wAh3uPJG1uFiTNya9dCJjNUPABXzo")blockhash_resp=connection.get_latest_blockhash()blockhash=blockhash_resp.value.blockhashtransfer_params=TransferParams(from_pubkey=from_address,to_pubkey=to_address,lamports=lamports_to_send,)transfer_instr=transfer(transfer_params)message=Message.new_with_blockhash([transfer_instr],from_address,blockhash,)#Createatransactionenvelopewithsignaturespacesig_count=bytes([1])#1byteforsignaturecount(1)empty_sig=bytes([0]*64)#64bytesofzerosfortheemptysignaturemessage_bytes=bytes(message)#Gettheserializedmessagebytes#Concatenatetoformthetransactionbytestx_bytes=sig_count+empty_sig+message_bytes#Encodetobase64usedbyCDPAPIserialized_tx=base64.b64encode(tx_bytes).decode("utf-8")signed_tx_response=awaitcdp.solana.sign_transaction(address,transaction=serialized_tx,)#Decodethesignedtransactionfrombase64decoded_signed_tx=base64.b64decode(signed_tx_response.signed_transaction)print("Sendingtransaction...")tx_resp=connection.send_raw_transaction(decoded_signed_tx,opts=TxOpts(skip_preflight=False,preflight_commitment="processed"),)signature=tx_resp.valueprint("Waitingfortransactiontobeconfirmed...")confirmation=connection.confirm_transaction(signature,commitment="processed")ifhasattr(confirmation,"err")andconfirmation.err:raiseValueError(f"Transactionfailed:{confirmation.err}")print(f"SentSOL:https://explorer.solana.com/tx/{signature}?cluster=devnet")asyncdefmain():account=awaitcreate_sol_account()awaitrequest_faucet(account.address)awaitwait_for_balance(account.address)awaitsend_transaction(account.address)awaitcdp.close()asyncio.run(main())```</Tab></Tabs>#Accounts##Overview**Accounts**refertoanaddressonablockchainthathastheabilitytosigntransactionsonbehalfoftheaddress,allowingyoutonotonlysendandreceivefunds,butalsointeractwithsmartcontracts.Cryptographically,anaccountcorrespondstoa**private/publickeypair**.<Info>**Accounts**areatermconsistentacrossthecryptoecosystem:[Ethereum](https://ethereum.org/en/glossary/#section-a),[Solana](https://solana.com/docs/core/accounts),and[viem](https://viem.sh/docs/faq#why-use-the-terms-wallet--account-instead-of-signer)usethistermtorefertothesameconcept.</Info>Thev2ServerWalletsupportsthefollowingaccounttypes:-**EVMCompatibleAccounts**:-**EOAs**:[ExternallyOwnedAccounts](https://ethereum.org/en/developers/docs/accounts/)onanyEVM-compatibleblockchainthathavetheabilitytosigntransactionsonbehalfofanaccount'saddress(i.e.,whenusingaSmartAccount).-**SmartAccount**:Asmartcontract-basedaccountthatcanprovideadvancedfunctionalitysuchasgassponsorshipsandspendpermissions.-**SolanaAccounts**:AnaccountontheSolanablockchain.<Tip>Morecodesamplesareavailableinour[Typescript](https://github.com/coinbase/cdp-sdk/blob/main/examples/typescript/README.md)and[Python](https://github.com/coinbase/cdp-sdk/blob/main/examples/python/README.md)SDKrepositories.</Tip>##EVMaccountsWhenusingthev2ServerWallet,ensureyouunderstandthedifferencesbetweenourtwoofferedaccounttypes,ExternallyOwnedAccounts(EOAs)andSmartAccountssothatyouselectthepropertypeforyourapplication.Thev2ServerWalletsupportsEOAson**allEVM-compatiblenetworks**andSmartAccountson\*\*Base,Arbitrum,Optimism,Zora,Polygon,BNB,AvalancheandEthereumMainnet\*\*.###EOAvsSmartAccountsWhilebothaccounttypesenableblockchaininteractions,theydiffersignificantlyintheirarchitecture,capabilities,andconstraints:|Feature|EOA|SmartAccount||----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------||**Control**|PrivatekeygeneratedandsecuredinCDP'sTEE|Controlledbysmartcontractcodewithanowneraccount(canbeaCDP-managedEOAorbringyourown)||**Creation**|Generatedneworimportedfromexistingprivatekey|CreatedwithCREATE2opcode,deployedonfirstoperation||**Transactiontype**|Direct,signedblockchaintransactions|Bundledtransactions(useroperations)||**Gaspayment**|<Iconicon="x"color="#ef4444"/>Mustpaygasfeesdirectly|<Iconicon="check"color="#10b981"/>Gassponsorshipavailableviapaymaster(subsidizedonBaseSepolia)||**Batchoperations**|<Iconicon="x"color="#ef4444"/>Singleoperationatatime|<Iconicon="check"color="#10b981"/>Multiplecallsinasingleuseroperation||**Ownerrequirements**|<Iconicon="x"color="#ef4444"/>Nonerequired|<Iconicon="check"color="#10b981"/>Requiresanowneraccount(CDPEOAorexternal)||**CDPlimitations**|None|Onesmartaccountperowner,oneownerpersmartaccount||**Networksupport**|<Iconicon="check"color="#10b981"/>AllEVMnetworkssupportedbyCDP|<Iconicon="check"color="#10b981"/>Base,Arbitrum,Optimism,Zora,Polygon,BNB,AvalancheandEthereumMainnet||**Concurrentoperations**|<Iconicon="check"color="#10b981"/>Canhavemultiplependingtransactions|<Iconicon="check"color="#10b981"/>SupportforconcurrentuserOperations||**viemcompatibility**|<Iconicon="check"color="#10b981"/>Worksseamlesslywithviemforallonchainactions|<Iconicon="check"color="#10b981"/>Smartaccountownersworkseamlesslywithviemforallonchainactions||**web3/eth-accountcompatibility**|<Iconicon="check"color="#10b981"/>Worksseamlesslywithweb3.pyand[eth-account](https://web3py.readthedocs.io/en/stable/web3.eth.account.html)librariesforallonchainactions|<Iconicon="check"color="#10b981"/>Smartaccountownersworkseamlesslywithweb3.pyand[eth-account](https://web3py.readthedocs.io/en/stable/web3.eth.account.html)librariesforallonchainactions||**Faucetsupport**|<Iconicon="check"color="#10b981"/>Base,Ethereum,Solana|<Iconicon="check"color="#10b981"/>Base,Ethereum,Solana|<Note>Needsupportforadditionalnetworks?Reachouttousonthe[CoinbaseDeveloperPlatformDiscord](https://discord.com/invite/cdp)inthe**#cdp-sdk**channel.</Note>###Usecases**UseEOAswhen:**-YouneedsupportacrossallEVMnetworks-Yourequiresimplewalletfunctionality-Youdon'tneedgassponsorshipfeatures**UseSmartAccountswhen:**-You'rebuildingonBaseSepoliaorBaseMainnet-Youneedtobatchmultipleoperationsinonetransaction-Youwanttosponsorgasfeesforusers-YouneedEIP-4337accountabstractionfeatures###ImplementationEOAsarecontrolleddirectlybyaprivatekey.####EOAsEOAscanbecreatedneworimportedfromexistingprivatekeys.Thefollowingexampleshowsbothmethods:```typescript//CreateanewEOAconstnewAccount=awaitcdp.evm.createAccount();//ImportanexistingEOAfromprivatekeyconstimportedAccount=awaitcdp.evm.importAccount({privateKey:"0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef",name:"imported-account"});```Here'showtocreateanEOAandsendasimpletransaction:<CodeGroup>```typescriptTypeScript//CreateanewEOAconstaccount=awaitcdp.evm.createAccount();//Sendatransactionconst{transactionHash}=awaitcdp.evm.sendTransaction({address:account.address,transaction:{to:"0x...",value:parseEther("0.1"),},network:"base-sepolia",});```````pythonPythonfromcdp.evm_transaction_typesimportTransactionRequestEIP1559fromweb3importWeb3#CreateanewEOAaccount=awaitcdp.evm.create_account()#Sendatransactiontx_hash=awaitcdp.evm.send_transaction(address=account.address,transaction=TransactionRequestEIP1559(to="0x...",value=Web3.to_wei(0.1,"ether"),),network="base-sepolia",)````</CodeGroup>ForacompleteexampleofcreatingandusingEOAs,seethe[quickstartguide](/server-wallets/v2/introduction/quickstart#evm).<Note>UnlikeSolana,EVMsigningishandledautomaticallybytheCDPSDK.Whenyoucall`sendTransaction()`forEOAsor`sendUserOperation()`forSmartAccounts,CDPmanagestheentiresigningandsubmissionprocess-youdon'tneedtomanuallyserialize,sign,orsubmittransactions.</Note>####SmartAccountsSmartAccountsoperatethroughdeployedsmartcontracts,enablingadvancedfeaturesthrough[EIP-4337AccountAbstraction](https://eips.ethereum.org/EIPS/eip-4337).WhencreatingaSmartAccount,anEOAmustbeprovidedastheowner(eitheraCDP-managedEOAoranexternalEOA).ASmartAccountisnotdeployeduntilitsfirstuseroperation:```typescriptconstsmartAccount=awaitcdp.evm.createSmartAccount({owner:evmAccount,});//Contractaddressisdeterministicbutnotyetdeployed//ContractisdeployedwiththefirstuseroperationconstsendResult=awaitcdp.evm.sendUserOperation({smartAccount,network:"base-sepolia",calls:[/*...*/],});```<Note>SmartAccountsusethe[CREATE2](https://eips.ethereum.org/EIPS/eip-1014)opcodefordeterministicaddresses,allowingthecontractaddresstobeknownbeforedeployment.</Note>Fordetailedimplementationexamplesincludingbatchoperationsandgassponsorship,seethe[SmartAccountsguide](/server-wallets/v2/evm-features/smart-accounts).##SolanaaccountsSolanaaccountsrepresentaddressesontheSolanablockchainthatcanholdSOLandothertokens.TheyfunctionsimilarlytoEOAsonEVMchainsbutwithsomekeydifferencesincapabilitiesandarchitecture.###FeaturesHere'swhat'savailableforSolanaaccountsinthev2ServerWallet:|Feature|SolanaAccountSupport|Notes||------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------||**Control**|<Iconicon="check"color="#10b981"/>PrivatekeysecuredinCDP's[TEE](/server-wallets/v2/introduction/security)|SimilartoEVMEOAs||**Creation**|<Iconicon="check"color="#10b981"/>Generatenewor[importexisting](/server-wallets/v2/using-the-wallet-api/import-accounts#solana-accounts-import-from-external-wallet-providers)|Frombase58orrawprivatekeys||**Transactionsigning**|<Iconicon="check"color="#10b981"/>NativeSolanatransactions|See[sendingtransactions](/server-wallets/v2/solana-features/sending-transactions)||**Messagesigning**|<Iconicon="check"color="#10b981"/>Off-chainmessagesigning|See[messagesigning](/server-wallets/v2/solana-features/message-signing)||**Gaspayment**|<Iconicon="x"color="#ef4444"/>Mustpayfeesdirectly|Senderpaystransactionfees||**Feesponsorship**|<Iconicon="check"color="#10b981"/>Via`feePayer`property|See[sponsoringtransactions](/server-wallets/v2/solana-features/sponsor-transactions)||**Batchoperations**|<Iconicon="check"color="#10b981"/>Multipleinstructionspertransaction|See[batchinginstructions](/server-wallets/v2/solana-features/batching-instructions)||**Tokentransfers**|<Iconicon="check"color="#10b981"/>SOLandSPLtokens|See[transfers](/server-wallets/v2/using-the-wallet-api/transfers)||**Programinteractions**|<Iconicon="check"color="#10b981"/>AnySolanaprogram|Fullsupport||**Faucetsupport**|<Iconicon="check"color="#10b981"/>Solanadevnetonly|See[quickstart](/server-wallets/v2/introduction/quickstart#solana)||**Networksupport**|<Iconicon="check"color="#10b981"/>MainnetandDevnet|`solana`and`solana-devnet`|<Note>CDPcurrentlysupportsstandardSolanaaccounts(similartoEOAsonEVM).WhileSolanadoessupportprogrammablewalletsandPDAs,theseadvancedaccounttypesarenotyetavailablethroughCDP'sServerWalletv2.</Note>###ImplementationCreatingandusingSolanaaccountswiththeCDPServerWalletisstraightforward.Thisexampledemonstratescreatinganaccount,fundingitviafaucet,andsigningamessage:<CodeGroup>```typescriptTypeScriptconstaccount=awaitcdp.solana.createAccount();awaitcdp.solana.signMessage({address:account.address,message:"HelloSolana!"});```````pythonPythonaccount=awaitcdp.solana.create_account()awaitcdp.solana.sign_message(address=account.address,message="HelloSolana!")````</CodeGroup>###TransactionsigningBeyondbasicaccountoperations,you'lloftenneedtosignandsend**transactions**.Whilemessagesigning,demonstratedabove,isusedtoverifyaccountownership(e.g.,forauthenticationoroff-chainverification),transactionsigningisusedtoauthorizeactualon-chainactions,suchastransferringSOLorinteractingwithaprogram.TheCDPServerWalletintegratesseamlesslywiththeSolanaWeb3.jslibraryfortransactionhandling.ForcompleteexamplesofcreatingSolanaaccountsandsendingtransactions,see:#ManagingAccounts##CreatingAccountsYoucanassignanametoanaccounttomakeiteasiertoaccess.Accountnamescanconsistofalphanumericcharactersandhyphens,andmustbebetween2and36characterslong.AccountnamesmustbeuniquewithinasingleCDPprojectforeachaccounttype(e.g.,allSolanaaccounts).Youcanassignanaccountnameatthetimeofaccountcreation,andretrieveitlaterusingthename.The`getOrCreateAccount`methodwillcreateanaccountifitdoesn'texist,andreturntheexistingaccountifitdoes.###EVMAccountsYoucancreateEVMaccountswithorwithoutnames.Hereareexamplesofbothapproaches:<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();console.log(`Createdaccount.Address:${account.address}.`);constnamedAccount=awaitcdp.evm.getOrCreateAccount({name:"MyAccount"});console.log(`Createdaccountwithname${account.name}.`);```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientimportdotenvdotenv.load_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:account=awaitcdp.evm.create_account()print(f"Createdaccount.Address:{account.address}.")named_account=awaitcdp.evm.get_or_create_account(name="MyAccount")print(f"Createdaccountwithname{named_account.name}.")asyncio.run(main())````</CodeGroup>###SmartAccountsYoucanalsocreateandmanagesmartaccountsthatareownedbyanEVMaccount.Eachowneraccountcanonlyhaveonesmartaccountassociatedwithit.The`getOrCreateSmartAccount`methodwillcreateasmartaccountifitdoesn'texistfortheowner,andreturntheexistingsmartaccountifitdoes.<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();//Createacoupleofowners,oneforeachsmartaccountwewillcreate.constfirstOwner=awaitcdp.evm.getOrCreateAccount({name:"ExampleOwner1"});constsecondOwner=awaitcdp.evm.getOrCreateAccount({name:"ExampleOwner2"});constaccount=awaitcdp.evm.createSmartAccount({owner:firstOwner,});console.log("CreatedSmartAccount.Address:",account.address);constnamedSmartAccount=awaitcdp.evm.getOrCreateSmartAccount({name:"MySmartAccount",owner:secondOwner});console.log("CreatedSmartAccount:",sameAccount.address);```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientimportdotenvdotenv.load_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:#Createacoupleofowners,oneforeachsmartaccountwewillcreate.first_owner=awaitcdp.evm.get_or_create_account(name="ExampleOwner1")second_owner=awaitcdp.evm.get_or_create_account(name="ExampleOwner2")account=awaitcdp.evm.create_smart_account(owner=first_owner)print("CreatedSmartAccount.Address:",account.address)named_account=awaitcdp.evm.get_or_create_smart_account(name="MySmartAccount",owner=second_owner)print("CreatedSmartAccount:",named_account.address)asyncio.run(main())````</CodeGroup>###SolanaAccountsYoucancreateSolanaaccountswithorwithoutnames.Hereareexamplesofbothapproaches:<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constaccount=awaitcdp.solana.createAccount();console.log(`Createdaccount.Address:${account.address}.`);constnamedAccount=awaitcdp.solana.getOrCreateAccount({name:"MyAccount"});console.log(`Createdaccountwithname${namedAccount.name}.`);```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientimportdotenvdotenv.load_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:account=awaitcdp.solana.create_account()print(f"Createdaccount.Address:{account.address}.")named_account=awaitcdp.solana.get_or_create_account(name="MyAccount")print(f"Createdaccountwithname{named_account.name}.")asyncio.run(main())````</CodeGroup>##ManagingExistingAccountsOnceyou'vecreatedaccounts,youcanretrieve,list,andupdatethemasneeded.###GettingAccountsbyAddressorNameYoucanretrieveaspecificaccountbyitsaddressornameusingthe`getAccount`method.<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();//Returnstheaccountwiththegivenaddress,ifitexists.constaccount=awaitcdp.evm.getAccount({address:"0x1234567890123456789012345678901234567890"});//Returnstheaccountwiththegivenname,ifitexists.constnamedAccount=awaitcdp.evm.getAccount({name:"MyAccount"});```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientimportdotenvasyncdefmain():asyncwithCdpClient()ascdp:#Returnstheaccountwiththegivenaddress,ifitexists.account=awaitcdp.evm.get_account(address="0x1234567890123456789012345678901234567890")#Returnstheaccountwiththegivenname,ifitexists.named_account=awaitcdp.evm.get_account(name="MyAccount")````</CodeGroup>###ListingAllAccountsYoucanlistallaccountsofaspecifictypeinasingleCDPprojectbycallingthe`listAccounts`method:<CodeGroup>```tsTypeScriptlineswrap[expandable]import{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();letresponse=awaitcdp.evm.listAccounts();//Paginatethroughallaccounts.while(true){for(constaccountofresponse.accounts){console.log('EVMaccount:',account.address);}if(!response.nextPageToken)break;response=awaitcdp.evm.listAccounts({pageToken:response.nextPageToken});}```````pythonPythonlineswrap[expandable]importasynciofromcdpimportCdpClientimportdotenvdotenv.load_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:response=awaitcdp.evm.list_accounts()whileTrue:foraccountinresponse.accounts:print('EVMaccount:',account.address)ifnotresponse.next_page_token:breakresponse=awaitcdp.evm.list_accounts(page_token=response.next_page_token)asyncio.run(main())````</CodeGroup>###UpdatingAccountsAftercreatinganaccount,youcanmodifyvariouspropertiesincludingtheaccountnameandattachpoliciestogovernaccountbehavior.####ChangingAccountNamesYoucanchangethenameofanexistingaccountusingthe`updateAccount`method:<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();//Getanexistingaccountconstaccount=awaitcdp.evm.getOrCreateAccount({name:"original-name"});console.log(`Originalaccountname:${account.name}`);//UpdatetheaccountnameconstupdatedAccount=awaitcdp.evm.updateAccount({address:account.address,update:{name:"new-name",},});console.log(`Updatedaccountname:${updatedAccount.name}`);```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientimportdotenvdotenv.load_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:#Getanexistingaccountaccount=awaitcdp.evm.get_or_create_account(name="original-name")print(f"Originalaccountname:{account.name}")#Updatetheaccountnameupdated_account=awaitcdp.evm.update_account(address=account.address,update={"name":"new-name",},)print(f"Updatedaccountname:{updated_account.name}")asyncio.run(main())````</CodeGroup>####AttachingPoliciesYoucanattach[policies](/server-wallets/v2/using-the-wallet-api/policies/overview)toaccountstogoverntheirbehavior,suchasrestrictingtransactionstospecificaddressesorlimitingtransactionvalues.Policiescanbeattachedduringaccountcreationoraddedlaterusingthe`updateAccount`method:<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();//Getanexistingaccountconstaccount=awaitcdp.evm.getOrCreateAccount({name:"policy-account"});constpolicyId="your-policy-id";//ReplacewithyouractualpolicyID//AttachapolicytotheaccountconstupdatedAccount=awaitcdp.evm.updateAccount({address:account.address,update:{accountPolicy:policyId,},});console.log(`Updatedaccount${updatedAccount.address}withpolicy:${updatedAccount.policies}`);```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientimportdotenvdotenv.load_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:#Getanexistingaccountaccount=awaitcdp.evm.get_or_create_account(name="policy-account")policy_id="your-policy-id"#ReplacewithyouractualpolicyID#Attachapolicytotheaccountupdated_account=awaitcdp.evm.update_account(address=account.address,update={"account_policy":policy_id,},)print(f"Updatedaccount{updated_account.address}withpolicy:{updated_account.policies}")asyncio.run(main())````</CodeGroup>#ImportingAccounts##OverviewTheCDPServerWalletoffersasecuremethodforcreatingEVMandSolanaAccountsfromimportedprivatekeys.Theimportflowisend-to-endencryptedbetweentheCDPSDKandthe[TEE](/server-wallets/v2/introduction/security#tee-architecture),ensuringthatkeysareneverexposedoutsideofthesecureenclaveduringtherequest.EncryptedbytheSDKinawaythatonlytheTEEcandecryptthekeys,thisprocessenablesseamlessandsecureimportofyourkeysintov2accounts.Thisfeaturecanbeusedtoimportwalletsfromexternalwalletprovidersandthe[v1ServerWallet](/server-wallets/v1/introduction/welcome).##EVMAccounts:ImportfromexternalwalletprovidersYoucanimportprivatekeysfromotherwalletprovidersbyexportingthemasraw,hex-encoded32-bytestrings.Tocompletetheimport,use`importAccount`inTypeScriptor`import_account`inthePythonCDPSDK.Onlyprivatekeyimportissupported.ToimportanHDWallet,deriveindividualprivatekeysfromtheseedandimportthemonebyone.<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.evm.importAccount({privateKey:"0x0123456789abcdef...",name:"ExternalWalletImportedAccount",});console.log("Importedaccount:",account.address);```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:account=awaitcdp.evm.import_account(private_key="0x0123456789abcdef...",name="ExternalWalletImportedAccount",)print("Importedaccount:",account.address)asyncio.run(main())````</CodeGroup>##SolanaAccounts:ImportfromexternalwalletprovidersHere'sanexampleofhowtoimportaSolanaaccountwithabase58-encodedprivatekeyfromawalletproviderlikePhantom.<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.solana.importAccount({privateKey:"4YFq9y5f5hi77Bq8kDCE6VgqoAq...",name:"ExternalWalletImportedAccount",});console.log("Importedaccount:",account.address);```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:account=awaitcdp.solana.import_account(private_key="4YFq9y5f5hi77Bq8kDCE6VgqoAq...",name="ExternalWalletImportedAccount",)print("Importedaccount:",account.address)asyncio.run(main())````</CodeGroup>YoucanalsoimportaSolanaaccountusingtheraw32-byteprivatekeyarray.<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constkeypair=Keypair.generate();constprivateKeyBytes32=keypair.secretKey.subarray(0,32);constaccount=awaitcdp.solana.importAccount({privateKey:privateKeyBytes32,name:"BytesAccount32",});console.log("Importedaccount:",account.address);```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:keypair=Keypair.generate()private_key_bytes32=keypair.secret_key[:32]account=awaitcdp.solana.import_account(private_key=private_key_bytes32,name="BytesAccount32",)print("Importedaccount:",account.address)asyncio.run(main())````</CodeGroup>##Import[developer-managedv1Wallets](/server-wallets/v1/concepts/wallets/#developer-managed-wallets)Akeydifferencebetweenv1walletsandv2accountsisthatv1walletsareHDWallets,whilev2accountsaresingle-addressaccounts.Importeachaddressfromyourv1walletasanindividualv2account,followingthestepsbelow.First,setupanewprojectandinstalldependencies```tsTypeScriptlineswrapmkdirimport-example&&cdimport-examplenpminit-y&&npmpkgsettype="module"npminstall@coinbase/coinbase-sdk@coinbase/cdp-sdkdotenv```Thebelowscriptdoesthefollowingtoimportfromv1walletstov2:1.Exportprivatekeyofv1addressusingv1SDK2.Importprivatekeysasav2accountusingv2SDK```tsTypeScriptlineswrap[expandable]//Step1:Exportprivatekeysofv1address.import{Coinbase,Wallet}from"@coinbase/coinbase-sdk";import{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();//ChangethistothepathofyourAPIkeyfile(ifdownloaded)fromCDPportal.Forbettersecurity,itisrecommendedtouseenvironmentvariablesinstead.Coinbase.configureFromJson({filePath:"~/Downloads/cdp_api_key.json"});//AddtheIDofthewalletanditsseedtoimport.constwallet_id=''constseed=''//Fetchthewalletandsettheseed.letwallet=awaitWallet.fetch(wallet_id);//YoucanalsoloadtheseedusingloadSeedFromFilecall.awaitwallet.setSeed(seed);console.log(`Walletsuccessfullyfetched:`,wallet.toString());//Exportprivatekeyofthedefaultaddress.letaddress=awaitwallet.getDefaultAddress();letprivateKey=address.export();//Step2:Importexportedprivatekeyasav2account.constcdp=newCdpClient();constaccount=awaitcdp.evm.importAccount({privateKey:privateKey,name:"ImportedAccount",});console.log("Importedaccount:",account.address);```##Import[Coinbase-managedv1Wallets](/server-wallets/v1/concepts/wallets/#coinbase-managed-wallets)Coinbase-Managedv1walletsuseMulti-PartyComputationtosplittheprivatekeysharesbetweenCoinbaseandthedeveloper.Thesewalletsdonotsupportprivatekeyexporttoday.Therefore,tomigratethesewallets,youmustcreateanewv2accountandtransferfundsonchainfromyourexistingv1addresses.Thev1SDK's[gaslesssends](/server-wallets/v1/concepts/transfers#gasless-transfers)featurecanbeusedforazero-costmigration.Createnewv2accountsforeachaddressinyourv1walletandtransferfundstothemusingthestepsbelow:1.Fetchthev1walletusingv1SDK2.Createnewv2accountusingv2SDK3.Sendfundsfromv1addresstothenewv2accountusingv1SDK```typescriptindex.jslineswrap[expandable]import{Coinbase,Wallet}from"@coinbase/coinbase-sdk";import{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();//Step1:Fetchthev1wallet.//ChangethistothepathofyourAPIkeyfile(ifdownloaded)fromCDPportal.Coinbase.configureFromJson({filePath:"~/Downloads/cdp_api_key.json"});Coinbase.useServerSigner=true;//AddtheIDofthev1wallet.constwallet_id=''letv1_wallet=awaitWallet.fetch(wallet_id);console.log(`Walletsuccessfullyfetched:`,v1_wallet.toString());//Step2:Createanewv2account.constcdp=newCdpClient();letv2_account=awaitcdp.evm.createAccount({name:"NewAccount",});console.log(`Createdaccount:${v2_account}successfully`);letbalance=awaitv1_wallet.getBalance(Coinbase.assets.Usdc);lettransfer;//Step3:Sendfundsfromv1addresstov2accountusinggaslesssendsfeature.try{transfer=awaitv1_wallet.createTransfer({amount:balance,assetId:Coinbase.assets.Usdc,destination:v2_account.address,gasless:true,});}catch(e){console.error(`Errortransferringfunds:${e}`)}//Waitforthetransfertolandon-chain.try{transfer=awaittransfer.wait();}catch(err){if(errinstanceofTimeoutError){console.log("Waitingfortransfertimedout");}else{console.error("Errorwhilewaitingfortransfertocomplete:",error);}}//Checkiftransfersuccessfullycompletedon-chain.if(transfer.getStatus()==='complete'){console.log('Transfercompletedon-chain:',transfer.toString());}else{console.error('Transferfailedon-chain:',transfer.toString());}```#ExportingAccounts##OverviewTheCDPServerWalletoffersasecuremethodforexportingprivatekeysofEVMandSolanaaccounts,thatarecompatiblewithallmajorwalletproviders,suchasCoinbaseWalletandMetamask.TheexportAPIisend-to-endencryptedbetweentheCDPSDKandthe[TEE](/server-wallets/v2/introduction/security#tee-architecture),ensuringthatkeysareneverexposedoutsideofthesecureenclavewhileexporting.TheprivatekeyisencryptedwithintheTEEbyasingle-useencryptionkeygeneratedwithintheSDK.<Warning>Exportingisasensitiveoperationthatputsyouraccount'ssecurityandprivatekeysatriskifnothandledsecurely.Itisimportanttostoretheprivatekeyinasecureplaceafterit'sexported.</Warning>##ExportingEVMaccountsExportprivatekeysfromyourEVMaccountsusingeithertheaccountaddressorname.<CodeGroup>```typescriptTypeScriptimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount({name:"ExportEvmAccount",});console.log("Accounttoexport:",account.address);//Exportaccountwithitsaddress.letprivateKey=awaitcdp.evm.exportAccount({address:account.address})//Exportaccountwithitsname.privateKey=awaitcdp.evm.exportAccount({name:account.name})```````pythonPythonimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:account=awaitcdp.evm.create_account(name="ExportEvmAccount")print("Accounttoexport:",account.address)#Exportaccountwithitsaddress.private_key=awaitcdp.evm.export_account(address=account.address)#Exportaccountwithitsname.private_key=awaitcdp.evm.export_account(name=account.name)asyncio.run(main())````</CodeGroup>##ExportingSolanaaccountsExportprivatekeysfromyourSolanaaccountsusingeithertheaccountaddressorname.<CodeGroup>```typescriptTypeScriptimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.solana.createAccount({name:"ExportSolanaAccount",});console.log("Accounttoexport:",account.address);//Exportaccountwithitsaddress.letprivateKey=awaitcdp.solana.exportAccount({address:account.address})//Exportaccountwithitsname.privateKey=awaitcdp.solana.exportAccount({name:account.name})```````pythonPythonimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:account=awaitcdp.solana.create_account(name="ExportSolanaAccount")print("Accounttoexport:",account.address)#Exportaccountwithitsaddress.private_key=awaitcdp.solana.export_account(address=account.address)#Exportaccountwithitsname.private_key=awaitcdp.solana.export_account(name=account.name)asyncio.run(main())````</CodeGroup>##APIKeyConfigurationforPrivateKeyExportInordertoprogrammaticallyexportaccountprivatekeys,you'llneedtomanuallyconfigureanAPIkeywithaspecificscope.Whenyou'recreatinganewAPIKey,firstexpandthe**APIrestrictions**panelthenscrolldowntothe**API-specificrestrictions**section.Ensurethat**Export(exportprivatekey)**ischeckedbeforekeycreationasseeninthefollowingscreenshot.#GovernbehaviorusingPolicies##OverviewCDPWalletssupport**Policies**thatenabledeveloperstogovernaccountandprojectbehavior.Policiesprovideflexibleconfigurationforenforcingcontrolsbasedontransactionparameterssuchasdestinationaddressandtransactionvalue.###Usecases-**Wallettransactionfiltering:**Preventtransferstoknownmaliciousorrestrictedaddresses-**Allowlistedaccesstoprojectfeatures:**Restrictaccessonlytoapprovedaddressestointeractwithasmartcontractormintatoken-**Transactionlimitsperaddress:**Limitfinancialriskbycappingtransactionvalues-**Preventsigningoffraudulentmessages:**Ensurecompromisedclientscannotprovecontrolofyouraccounts-**USDSpendLimits:**RestricttheamountinUSDthatcanbesent,orapproved,inasingletransaction.###PolicyfielddefinitionsApolicyisdefinedbythefollowingfields:|Field|Description|Validvalues||-----------|------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------||`scope`|Thelevelatwhichapolicygetsapplied|`project`or`account`||`rules`|Alistofrulesthatareusedtogovernthebehaviorofaccounts|Anarrayofrules||`action`|Theactiontotakewhenapolicyisapplied|`accept`or`reject`||`operation`|Theoperationtoperformwhenapolicyisapplied|`signEvmTransaction`,`sendEvmTransaction`,`signEvmMessage`,`signEvmHash`,`signEvmTypedData`,`signSolTransaction`,`sendSolTransaction`,`signSolMessage`,`prepareUserOperation`,or`sendUserOperation`||`criteria`|Thelistoflogicalexpressionsthatareevaluatedtoatransactiontodeterminewhetheraruleshouldbeappliedornot|Anarrayofcriteria.See[APIReference](/api-reference/v2/rest-api/policy-engine/list-policies)formoredetails.|###EvaluationprocessA`project`-levelpolicywillbeevaluatedfirst,followedbyany`account`-levelpolicies.Readmoretechnicaldetailsonpolicyevaluationinthe[APIReferencedocumentation](/api-reference/v2/rest-api/policy-engine/list-policies).```jsonproject-policy.json[expandable]lineswrap{"description":"Anexampleprojectlevelpolicy","scope":"project","rules":[{"action":"accept","operation":"signEvmTransaction","criteria":[{"type":"ethValue","ethValue":"1000000000000000000","operator":"<="}]},{"action":"accept","operation":"signEvmTransaction","criteria":[{"type":"ethValue","ethValue":"2000000000000000000","operator":"<="},{"type":"evmAddress","addresses":["0x123"],"operator":"in"}]}]}```<Accordiontitle="Howwouldthispolicybeevaluated?">Inthisexample,thepolicyhastworules.Anincomingtransactionwouldbeprocessedagainsteachruleasfollows:1.Acceptanytransactionwithavaluelessthanorequalto1ETH(expressedinWei).2.Acceptanytransactionwithavaluelessthanorequalto2ETH,andanaddressintheallowlist.Assumewehavetwotransactionrequeststothesameaddress,0x123:1.TransactionAwithavalueof0.5ETH2.TransactionBwithavalueof2ETH-**TransactionA**wouldbeacceptedonthefirstrule,andthepolicyenginewouldstopevaluationagainstthispolicy.-**TransactionB**wouldbeprocessedagainstbothrules.Itwouldberejectedonthefirstrule,butacceptedonceprocessedagainstthesecondrule.</Accordion>###SupportedoperationsEachruledefinesthebehaviorofacertain`operation`.The`operation`correspondstoaCDPv2API.Currently,thefollowingoperationsaresupported:**EVMOperations:**-`signEvmTransaction`:ToidentifyincomingsigningtransactionsonanEVMcompatiblenetwork-`sendEvmTransaction`:Toidentifyincomingsigningtransactionsthatarethensenttoasupportednetwork-`signEvmTypedData`:Toidentifyincomingtypeddatatobesignedbyanaccount-`signEvmMessage`:Toidentifyincomingmessagestobesignedbyanaccount-`signEvmHash`:Toidentifyincominghashtobesignedbyanaccount-`prepareUserOperation`:Forpreparinguseroperationsonasmartaccount-`sendUserOperation`:Forsendinguseroperationsusingasmartaccount**SolanaOperations:**-`signSolTransaction`:ToidentifyincomingsigningtransactionsontheSolananetwork-`sendSolTransaction`:ToidentifyincomingsigningtransactionsthatarethensenttotheSolanamainnetordevnetnetwork.-`signSolMessage`:ToidentifyincomingmessagestobesignedbyaSolanaaccountYoucanfindmoredetailsinthe[APIreferencedocumentation](/api-reference/v2/rest-api/policy-engine/list-policies).###APIKeyConfigurationInordertosecurelymanagePoliciesviaAPIorSDK,you'llneedtomanuallyconfigureanAPIkeywithaspecificscope.ThisscopeisrequiredtoperformthefollowingAPIoperations:-CreatePolicy-UpdatePolicy-DeletePolicy-AccountPolicyassignmentWhenyou'recreatinganewAPIKey,firstexpandthe**APIrestrictions**panelthenscrolldowntothe**API-specificrestrictions**section.Ensurethat**Manage(modifypolicies)**ischeckedbeforekeycreationasseeninthefollowingscreenshot.<Frame><imgsrc="https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/manage-policies-api-scope.png?fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=408bbafd88c6d6a6824f17bab9a201fd"alt="PoliciesScope"data-og-width="990"width="990"data-og-height="1478"height="1478"data-path="server-wallets/images/manage-policies-api-scope.png"data-optimize="true"data-opv="2"srcset="https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/manage-policies-api-scope.png?w=280&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=719b020f5c85390df0e8212a75266fd5280w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/manage-policies-api-scope.png?w=560&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=42dc5956194ab82e9e42b1e3e1784bb7560w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/manage-policies-api-scope.png?w=840&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=d3f123411f7ee72c99443136fc242add840w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/manage-policies-api-scope.png?w=1100&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=c53bd5d8f2e0272360b8a40389ad5fa61100w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/manage-policies-api-scope.png?w=1650&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=1ee65fe5a375b63ff7c4c3e6ed6676b71650w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/manage-policies-api-scope.png?w=2500&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=7b5e32a9b141f6d01d0292ac7554a1212500w"/></Frame>##DefineapolicyPoliciescanbedefinedviaCDPPortalUIorviatheCDPSDK.<Note>Youmayonlycreateoneproject-levelpolicyperproject.</Note>###UI(CDPPortal)1.Navigateto[Policies](https://portal.cdp.coinbase.com/products/server-wallets/policies)intheCDPPortal.<Frame><imgsrc="https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-dashboard.png?fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=02d852be9892c27aa99a21219e65bca2"alt="PoliciesUI"data-og-width="1412"width="1412"data-og-height="465"height="465"data-path="server-wallets/images/policy-engine-dashboard.png"data-optimize="true"data-opv="2"srcset="https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-dashboard.png?w=280&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=664bf069747fe05e4077ddd05d3c8ace280w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-dashboard.png?w=560&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=2d2647f30c01e9d629472c833b93e5d0560w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-dashboard.png?w=840&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=9c43228f0deafb3a82ff90d8d907b9e3840w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-dashboard.png?w=1100&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=90f749de13e5ac7a7d1f492342f65fd31100w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-dashboard.png?w=1650&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=2dac87e6e6e495eee75df9079d525b3f1650w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-dashboard.png?w=2500&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=f80ccf9b741d5385d9e506a5993d60de2500w"/></Frame>2.Clickthe**Createnewpolicy**buttontoaccesstheJSONeditor.Themodalwillcontainasamplepolicythatyoucanedit,butyoucanalsousesomeoftheexamplesinour[EVMPolicies](/server-wallets/v2/using-the-wallet-api/policies/evm-policies)or[SolanaPolicies](/server-wallets/v2/using-the-wallet-api/policies/solana-policies)documentation.<Frame><imgsrc="https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-editor-modal.png?fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=8ee355f9bdb6f90550bea636ffd5d855"alt="JSONEditor"data-og-width="609"width="609"data-og-height="681"height="681"data-path="server-wallets/images/policy-engine-editor-modal.png"data-optimize="true"data-opv="2"srcset="https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-editor-modal.png?w=280&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=f418f445a97d8c044d4b1221d1b5ae18280w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-editor-modal.png?w=560&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=276d748ffe5ad11ad50bc7e116cc14fb560w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-editor-modal.png?w=840&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=29b452654de0508ede65329fd105d676840w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-editor-modal.png?w=1100&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=62d6b4aa4c1464676bccfeffaa2762281100w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-editor-modal.png?w=1650&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=35454121580172c2022cb8fdabb70ca11650w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-editor-modal.png?w=2500&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=59481e2e9948a7dc58b4f65bf265c9642500w"/></Frame>3.Definethepolicyandclickthe**Create**button.Ifsuccessful,youshouldseea"Policycreated"message.4.RefreshthepagetoseethenewpolicylistedinthePoliciesdashboard:<Frame><imgsrc="https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-policies-dashboard.png?fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=e6ec738b68a5dc3b56ab404f57391d4b"alt="PolicyEnginedashboard"data-og-width="1143"width="1143"data-og-height="405"height="405"data-path="server-wallets/images/policy-engine-policies-dashboard.png"data-optimize="true"data-opv="2"srcset="https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-policies-dashboard.png?w=280&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=24bb681ce386b35ae32b74a0a9425df0280w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-policies-dashboard.png?w=560&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=93c079beebaded2c484b4cae56395b51560w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-policies-dashboard.png?w=840&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=ff6242d9db60d92380eedc539d9f650f840w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-policies-dashboard.png?w=1100&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=d73469ba728c4ba8252d89bbea9d1e601100w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-policies-dashboard.png?w=1650&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=caf9215d4e4a79a353b2c5309b8169d51650w,https://mintcdn.com/coinbase-prod/s_QeFV8SFwGVfV_u/server-wallets/images/policy-engine-policies-dashboard.png?w=2500&fit=max&auto=format&n=s_QeFV8SFwGVfV_u&q=85&s=d4e0f2a6113eaf32f6bc939f1b706b0e2500w"/></Frame>Clickthe**View**buttontoeditordeletethepolicy.5.AccountlevelpoliciesshouldbeaddedtotheaccountprogrammaticallyviatheSDK.<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();constpolicyId=""//PastethepolicyIDcreatedonportal.//Updatetheaccounttoaddtheaccountpolicy.constupdatedAccount=awaitcdp.evm.updateAccount({address:account.address,update:{accountPolicy:policyId,}})console.log("Updatedaccount%swithpolicy:%s",updatedAccount.address,updatedAccount.policies);```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvfromcdp.update_account_typesimportUpdateAccountOptionsload_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:account=awaitcdp.evm.create_account()policy_id=""#PastethepolicyIDcreatedonportal.updatedAccount=awaitcdp.evm.update_account(address=account.address,update=UpdateAccountOptions(account_policy=policy_id,),)print(f"Updatedaccount{account.address}withpolicy{updatedAccount.policies}")asyncio.run(main())````</CodeGroup>###Programmatically<Note>InordertomanagePoliciesviaSDKorAPI,youneedtohaveanAPIKeywith[Policymanagementenabled](#api-key-configuration)</Note>Tocreateapolicyprogrammatically,youcanusetheCDPSDK.Thecodebelowdemonstratesbasicpolicycreationandmanagement:1.CreateanEVMaccountnamed`PolicyAccount`2.Createanaccount-levelpolicythatonlyallowstransactionslessthanorequalto1ETHtotheaddress`0x000000000000000000000000000000000000dEaD`3.Applythepolicytotheaccountwecreated4.Createanotheraccountnamed`OtherPolicyAccount`whichhastheabovepolicyappliedduringcreation5.Createaproject-levelpolicythatonlyallowstransactionslessthanorequalto5ETHtotheaddress`0x000000000000000000000000000000000000dEaD`<Note>Aproject-levelpolicyisautomaticallyappliedtoallaccountsintheprojectoncreation.Anaccount-levelpolicymaybeappliedtoanaccountin2ways:_during_accountcreation,or_after_accountcreationbyupdatingtheaccount.</Note><CodeGroup>```tsTypeScript[expandable]lineswrapimport{CdpClient}from"@coinbase/cdp-sdk";constcdp=newCdpClient();constaccount=awaitcdp.evm.getOrCreateAccount({name:"PolicyAccount"});console.log("Accountaddress:",account.address);//Createpolicyconstpolicy=awaitcdp.policies.createPolicy({policy:{scope:"account",description:"AccountAllowlistExample",rules:[{action:"accept",operation:"signEvmTransaction",criteria:[{type:"ethValue",ethValue:"1000000000000000000",//1ETHinweioperator:"<=",},{type:"evmAddress",addresses:["0x000000000000000000000000000000000000dEaD"],operator:"in",},],},],},});console.log("Createdpolicy:",policy.id);//ApplypolicytotheaccountconstupdatedAccount=awaitcdp.evm.updateAccount({address:account.address,update:{accountPolicy:policy.id}});console.log("Appliedpolicytoaccount:",updatedAccount.address);//CreateanotheraccountwithpolicyimmediatelyappliedtoitconstotherAccount=awaitcdp.evm.createAccount({name:"OtherPolicyAccount",accountPolicy:policy.id});console.log("Otheraccountaddress:",otherAccount.address);//CreateprojectpolicyexampleconstprojectPolicy=awaitcdp.policies.createPolicy({policy:{scope:"project",description:"ProjectTransactionLimitExample",rules:[{action:"accept",operation:"signEvmTransaction",criteria:[{type:"ethValue",ethValue:"5000000000000000000",//5ETHinweioperator:"<=",},{type:"evmAddress",addresses:["0x000000000000000000000000000000000000dEaD"],operator:"in",},],},],},});console.log("Createdprojectpolicy:",projectPolicy.id);```````pythonPythonlineswrap[expandable]importasynciofromcdpimportCdpClientfromdotenvimportload_dotenvfromcdp.policies.typesimportCreatePolicyOptions,EthValueCriterion,EvmAddressCriterion,SignEvmTransactionRulefromcdp.update_account_typesimportUpdateAccountOptionsload_dotenv()asyncdefmain():cdp=CdpClient()account=awaitcdp.evm.get_or_create_account(name="PolicyAccount")print(f"Accountaddress:{account.address}")#Createpolicypolicy=awaitcdp.policies.create_policy(policy=CreatePolicyOptions(scope="account",description="AccountAllowlistExample",rules=[SignEvmTransactionRule(action="accept",criteria=[EthValueCriterion(ethValue="1000000000000000000",#1ETHinweioperator="<=",),EvmAddressCriterion(addresses=["0x000000000000000000000000000000000000dEaD"],operator="in",),],)],))print(f"Createdpolicy:{policy.id}")#Applypolicytotheaccountupdated_account=awaitcdp.evm.update_account(address=account.address,update=UpdateAccountOptions(account_policy=policy.id),)print(f"Appliedpolicytoaccount:{updated_account.address}")#Createanotheraccountwithpolicyimmediatelyappliedtoitother_account=awaitcdp.evm.create_account(name="OtherPolicyAccount",account_policy=policy.id,)print(f"Otheraccountaddress:{other_account.address}");#Createprojectpolicyexampleproject_policy=awaitcdp.policies.create_policy(policy=CreatePolicyOptions(scope="project",description="ProjectTransactionLimitExample",rules=[SignEvmTransactionRule(action="accept",criteria=[EthValueCriterion(ethValue="5000000000000000000",#5ETHinweioperator="<=",),EvmAddressCriterion(addresses=["0x000000000000000000000000000000000000dEaD"],operator="in",),],)],))print(f"Createdprojectpolicy:{project_policy.id}")awaitcdp.close()asyncio.run(main())````</CodeGroup><Note>Aproject-levelpolicyisautomaticallyappliedtoallaccountsintheprojectoncreation.Anaccount-levelpolicymaybeappliedtoanaccountin2ways:_during_accountcreation,or_after_accountcreationbyupdatingtheaccount.</Note>#EVMPolicyExamples##OverviewThispageprovidescomprehensiveexamplesandimplementationsforEVM-basedpolicyconfigurations.ThesepoliciescontrolEVMtransactionsigning,sending,messagesigning,andsmartaccountoperations.Forgeneralpolicyconceptsandsetupinstructions,seethe[PoliciesOverview](/server-wallets/v2/using-the-wallet-api/policies/overview).##SupportedEVMOperationsEVMpoliciessupportthefollowingoperations:-`signEvmTransaction`:ToidentifyincomingsigningtransactionsontheEVMnetwork-`sendEvmTransaction`:Toidentifyincomingsigningtransactionsthatarethensenttoasupportednetwork-`signEvmTypedData`:Toidentifyincomingtypeddatatobesignedbyanaccount-`signEvmMessage`:Toidentifyincomingmessagestobesignedbyanaccount-`signEvmHash`:Toidentifyincominghashtobesignedbyanaccount-`prepareUserOperation`:Forpreparinguseroperationsonasmartaccount-`sendUserOperation`:Forsendinguseroperationsusingasmartaccount##SupportedCriteriaTypesThefollowingcriteriatypesareavailableforEVMpolicies:-**`evmAddress`**:CriterionforrecipientaddressesofEVMtransactions-**`ethValue`**:CriterionforETHvalueinweiofnativetransfers-**`evmNetwork`**:CriterionforrestrictingtransactionstospecificEVMnetworks-**`evmMessage`**:Criterionforvalidatingmessagecontentusingregexpatterns-**`evmData`**:CriterionfortransactiondatavalidationusingcontractABI-**`evmTypedDataVerifyingContract`**:CriterionforEIP-712verifyingcontractaddresses-**`evmTypedDataField`**:CriterionforvalidatingspecificfieldswithinEIP-712typeddata-**`netUSDChange`**:CriterionforUSD-denominatedlimitsonassettransfersandapprovals##Examplepolicies###AllowlistThefollowingexampledemonstratesapolicythatallowssigningtransactionsonlytospecificEVMaddresses.Transactionstoanyaddressoutsideofthislistwillautomaticallybedeletedbythepolicyengine.```jsonallow-list-policy.jsonlineswrap{"description":"Allowlistpolicyexample","rules":[{"action":"accept","criteria":[{"addresses":["0xffffffffffffffffffffffffffffffffffffffff","0x1111111111111111111111111111111111111111"],"operator":"in","type":"evmAddress"}],"operation":"signEvmTransaction"}],"scope":"project"}```Theabovepolicytreatsthesetof`addresses`asanallowlist,onlyacceptingsigntransactionrequeststoanEVMaddressthatis`in`theset.###DenylistThefollowingexampledemonstratesapolicythatrejectssigningtransactionstospecificEVMaddresses.Transactionswith`to`fieldsettoanyaddressoutsideofthislistwillbeaccepted.```jsondeny-list-policy.jsonlineswrap{"description":"Denylistpolicyexample","rules":[{"action":"accept","criteria":[{"addresses":["0xffffffffffffffffffffffffffffffffffffffff","0x1111111111111111111111111111111111111111"],"operator":"notin","type":"evmAddress"}],"operation":"signEvmTransaction"}],"scope":"project"}```Theabovepolicytreatsthesetof`addresses`asadenylist,rejectinganysigntransactiontoanaddressthatis`notin`theset.###TransactionlimitsThefollowingexampledemonstratesapolicythatonlypermitssigningtransactionswithavalueof2000000000000000000wei(2ETH)orless.```jsontransaction-limit-policy.jsonlineswrap{"description":"Transactionlimitpolicy","scope":"project","rules":[{"action":"accept","operation":"signEvmTransaction","criteria":[{"type":"ethValue","ethValue":"2000000000000000000","operator":"<="}]}]}```###USDLimitsThefollowingexampledemonstratesapolicythatonlyallowstransactionstotransfer,orexposethesenderto,lessthan\$100.00worthofassetsatatimeforbothEOAaccountsandSmartAccounts.ThisUSDdenominatedamountincludesnativeassets,`ERC20`,`ERC721`,and`ERC1155`tokenscalculatedusingcurrentmarketprices.<Note>The`netUSDChange`criterioncanonlybeappliedtomainnettransactions;itwillbeignoredfortestnettransactions.</Note><Accordiontitle="Howischangecalculated?">Thetotalchangerepresentsthedollarvalueofassetsthattheusereithersendsdirectly,orallowsaspendertoaccessfromtheirwallet,inasingletransaction.Thisincludes:-Nativeassettransfers-Non-nativetokentransfers-Tokenapprovalsfrom`approve`,`setApprovalForAll`,and`permit`functionsForexample,ifyouapprove10,000USDworthoftokens,thecalculatedchangeisis10,000USD.Thespenderhasn'ttakenanythingyet,buttheycouldtakeuptothatamount.**HighRiskExamples**-Approvingunlimitedtokens`(type(uint256).max)`toanunknowncontract-Givingapprovaltoaddresseswithknownmalicioushistory-`setApprovalForAll`forvaluableNFTcollections**LowerRiskExamples**-Limitedapprovalstowell-knownDEXslikeUniswap-Approvalstoverified,reputableprotocols-Time-limitedpermitsignatures</Accordion>```jsonusd-change-policy.jsonlineswrap{"scope":"account","description":"Acceptassetsoutunder100USD","rules":[{"action":"accept","operation":"sendEvmTransaction","criteria":[{"type":"netUSDChange","changeCents":10000,"operator":"<",},],},{"action":"accept","operation":"signEvmTransaction","criteria":[{"type":"netUSDChange","changeCents":10000,"operator":"<",},],},{"action":"reject","operation":"prepareUserOperation","criteria":[{"type":"netUSDChange","changeCents":10000,"operator":">",},],},{"action":"reject","operation":"sendUserOperation","criteria":[{"type":"netUSDChange","changeCents":10000,"operator":">",},],}],}```###NetworkrestrictionsThefollowingexampledemonstratesapolicythatonlypermitssendingtransactionsontheBaseSepolianetwork.```jsonrestricted-network-policy.jsonlineswrap{"description":"Restrictednetworkpolicy","scope":"project","rules":[{"action":"accept","operation":"sendEvmTransaction","criteria":[{"type":"evmNetwork","networks":["base-sepolia"],"operator":"in"}]}]}```###Multi-rulepoliciesLearnmoreoncombiningmultiplerulesinasinglepolicy.-[**Allowlistfirst**](#allowlist-first):Apolicythatcheckstheallowlistfirst,thenthetransactionlimit.-[**Allowlistsecond**](#allowlist-second):Apolicythatchecksthetransactionvaluefirst,thenusesacombinedruletocheckboththetransactionvalueandtheallowlist.####AllowlistfirstThefollowingexampledemonstratesapolicythatcontainsbothanallowlistandatransactionlimit.```jsoncombined-policy-1.jsonlineswrap{"description":"Allowlistthenvaluelimit","scope":"project","rules":[{"action":"accept","operation":"signEvmTransaction","criteria":[{"type":"evmAddress","addresses":["0xffffffffffffffffffffffffffffffffffffffff"],"operator":"in"}]},{"action":"accept","operation":"signEvmTransaction","criteria":[{"type":"ethValue","ethValue":"2000000000000000000","operator":"<="}]}]}```Intheexampleabove,assumeausersendsasigntransactionrequestwithavalueof4000000000000000000wei(4ETH)totheaddress0x123:1.Thetransactionwillberejectedagainstthefirstrule,astheaddressisnotintheallowlist.However,thecriteriastillisnotmetandtheenginewillevaluatethetransactionagainstthesecondrule.2.Thetransactionwillberejectedagainstthesecondrule,asthevalueisgreaterthan2000000000000000000wei(2ETH).####AllowlistsecondLet'stakealookatanothercombinedpolicyexamplewherewedefinetheallowlistasthesecondruleinsteadofthefirst.```jsoncombined-policy-2.jsonlineswrap{"description":"Valuelimitthenallowlist","scope":"project","rules":[{"action":"accept","operation":"signEvmTransaction","criteria":[{"type":"ethValue","ethValue":"1000000000000000000","operator":"<="}]},{"action":"accept","operation":"signEvmTransaction","criteria":[{"type":"ethValue","ethValue":"2000000000000000000","operator":"<="},{"type":"evmAddress","addresses":["0xffffffffffffffffffffffffffffffffffffffff"],"operator":"in"}]}]}```Intheaboveexample,ifausersendsatransactionwithavalueof1500000000000000000wei(1.5ETH)totheaddress0x123:1.Thetransactionwillberejectedagainstthefirstrule,asthevalueisgreaterthan1000000000000000000wei.However,thecriteriastillisnotmetandtheenginewillcontinueevaluatingthetransactionagainstthesecondrule.2.Thetransactionmatchesagainstthesecondrule,asthevalueislessthanorequalto2000000000000000000wei**AND**theaddressisintheallowlist.Thetransactionwillbeaccepted.<Accordiontitle="What'sthedifference?">Theprimarydifferencesbetweenthesetwoexamplesaretheruleorderinwhichatransactionisevaluated.-**Thefirstexamplecheckstheallowlistfirst,andthenthetransactionlimit**-Thisoptionismorerestrictive,asitrequiresalltransactionsgotoallowlistedaddressesfirst,regardlessoftheirvalue.-**Thesecondexamplechecksthetransactionvaluefirst,thenusesacombinedruletocheckboththetransactionvalueandtheallowlist**\*Thisoptionoffersmoregranularcontrolbyallowingsmalltransactionstobesignedtoanyaddress,butrestrictslargertransactionstoallowlistedaddressesonly.</Accordion>###MessagesigningrestrictionsThefollowingexampledemonstrateshowtoguaranteeanyattempttosignamessagewillconformtoaspecifictemplate.Whencomposingaregularexpressioninthe`match`field,anyvalid[re2](https://github.com/google/re2)regularexpressionsyntaxwillbeaccepted.```jsonaccept-sign-message-policy.jsonlineswrap{"description":"Acceptsignmessagepolicy","scope":"project","rules":[{"action":"accept","operation":"signEvmMessage","criteria":[{"type":"evmMessage","match":"^IsolemnlyswearthatI,(.*),amuptonogood\.$"}]}]}```###LimitingUSDCSpendThispolicyrestrictsUSDCtransactionsontheBasenetworktotransfersof10,000tokensorless.ItappliestobothsigningandsendingtransactionstotheUSDCcontractaddress,usingtheERC20ABItovalidatethatonly`transfer`functioncallswitha`value`parameterunderthespecifiedlimitarepermitted.```jsonlimit-usdc-spend-policy.json{"description":"LimitUSDCSpend","scope":"account","rules":[{"action":"accept","operation":"sendEvmTransaction","criteria":[{"type":"evmNetwork","networks":["base"],"operator":"in"},{"type":"evmAddress","addresses":["0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"],"operator":"in"},{"type":"evmData","abi":"erc20","conditions":[{"function":"transfer","params":[{"name":"value","operator":"<=","value":"10000"}]}]}]},{"action":"accept","operation":"signEvmTransaction","criteria":[{"type":"evmAddress","addresses":["0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"],"operator":"in"},{"type":"evmData","abi":"erc20","conditions":[{"function":"transfer","params":[{"name":"value","operator":"<=","value":"10000"}]}]}]}]}```###TransactiondatarestrictionswithcustomABIWhenworkingwithsmartcontractsthataren'tcoveredbystandardtokeninterfaces(ERC20,ERC721,ERC1155),youneedtoprovideacustomABItoenablethepolicyenginetodecodeandvalidatetransactiondata.Thisisessentialfor:-**Customsmartcontracts**:Protocolswithuniquefunctionsignaturesandparameters-**ComplexDeFiinteractions**:Multi-stepoperations,customswaps,orgovernancefunctions-**Proprietarycontracts**:Internalbusinesslogicthatrequiresspecificvalidationrules-**Non-standardtokenimplementations**:TokenswithadditionalfeaturesbeyondbasicstandardsThecustomABIallowsthepolicyenginetounderstandthefunctionbeingcalledandvalidatespecificparametersaccordingtoyoursecurityrequirements.```jsoncustom-abi-policy.json{"description":"ProprietaryStakingContract","scope":"account","rules":[{"action":"accept","operation":"signEvmTransaction","criteria":[{"type":"evmAddress","addresses":["0x1234567890123456789012345678901234567890"],"operator":"in"},{"type":"evmData","abi":[{"type":"function","name":"stakeTokens","inputs":[{"name":"amount","type":"uint256","internalType":"uint256"},{"name":"duration","type":"uint256","internalType":"uint256"},{"name":"beneficiary","type":"address","internalType":"address"}],"outputs":[{"name":"stakeId","type":"uint256","internalType":"uint256"}],"stateMutability":"nonpayable"}],"conditions":[{"function":"stakeTokens","params":[{"name":"amount","operator":"<=","value":"1000000000000000000000"},{"name":"duration","operator":">=","value":"86400"},{"name":"beneficiary","operator":"in","values":["0xabcdefabcdefabcdefabcdefabcdefabcdefabcd","0x1111111111111111111111111111111111111111"]}]}]}]}]}```Thispolicyrestrictsthe`stakeTokens`functionto:-Maximumstakeamountof1000tokens(assuming18decimals)-Minimumdurationof1day(86400seconds)-Onlyallowstakingforpre-approvedbeneficiaryaddresses###DisablesigningarbitraryhashesTheexamplebelowdemonstratesapolicytopreventfraudbyrejectinganyattempttosignahash(i.e.,undefinedorarbitraryinputdata)onbehalfofanaccount.```jsonreject-sign-hash-policy.jsonlineswrap{"description":"Rejectsignhashpolicy","scope":"project","rules":[{"action":"reject","operation":"signEvmHash"}]}```###EIP-712verifyingcontractallowlistThefollowingexampledemonstratesapolicythatpreventssigningtypeddataforthezeroaddress.Thisensuresthattypeddatasignaturescannotbecreatedforinvalidorburnaddresses.```jsonsign-typed-data-verifying-contract-policy.jsonlineswrap{"description":"Preventtypeddatasigningforzeroaddress","scope":"account","rules":[{"action":"accept","operation":"signEvmTypedData","criteria":[{"type":"evmTypedDataVerifyingContract","addresses":["0x0000000000000000000000000000000000000000"],"operator":"notin"}]}]}```ThispolicyusestheverifyingcontractaddressfromtheEIP-712domaintoensurethattypeddatasignaturesarenotcreatedforthezeroaddress.Youcanextendthistocreateanallowlistbyusingthe`"in"`operatorwithtrustedcontractaddresses,oradenylistbyusing`"notin"`withuntrustedaddresses.###EIP-712fieldrestrictionsThefollowingexampledemonstratesamoreadvancedpolicythatvalidatesspecificfieldswithintypeddata.ThispolicyrestrictsanarbitraryPaymentdatatypetoaspecificaddress,messagecontent,andamount:```jsonsign-typed-data-field-policy.jsonlineswrap{"description":"RestrictPaymentdatatype","scope":"account","rules":[{"action":"accept","operation":"signEvmTypedData","criteria":[{"type":"evmTypedDataField","types":{"primaryType":"Payment","types":{"EIP712Domain":[{"name":"name","type":"string"},{"name":"version","type":"string"},{"name":"chainId","type":"uint256"},{"name":"verifyingContract","type":"address"}],"Payment":[{"name":"to","type":"address"},{"name":"amount","type":"uint256"},{"name":"message","type":"string"},]}},"conditions":[{"path":"to","operator":"in","value":["0x1234567890123456789012345678901234567890","0xabcdefabcdefabcdefabcdefabcdefabcdefabcd"]},{"path":"message","match":"^hello.*"},{"path":"amount","operator":"<=","value":"100"}]}]}]}```Thispolicyusesthe`evmTypedDataField`criteriontoinspecttheactualdatabeingsigned.The`evmTypedDataField`criterionsupportsconditionsonnumericalvalues,addressesandstrings.<Accordiontitle="DifferencebetweenevmTypedDataVerifyingContractandevmTypedDataField">***`evmTypedDataVerifyingContract`**:ChecksonlytheverifyingcontractaddressintheEIP-712domain.Thisissimplerandusefulforallowlisting/denylistingcontracts.***`evmTypedDataField`**:Allowsinspectionoftheentiretypeddatastructureincludingtypesandfieldvalues.Thisenablesmorecomplexvalidationslikecheckingspecificfieldvalues,ranges,ordatatypes.</Accordion>###SmartAccountOperationsThefollowingpolicyrestrictsSmartAccountoperationstoUSDCtransactionsontheBasenetwork,withtransfersof10,000tokensorless.ItappliestobothprepareandsendoperationstotheUSDCcontractaddress,usingtheERC20ABItovalidatethatonly`transfer`functioncallswitha`value`parameterunderthespecifiedlimitarepermitted.```jsonsmart-account-operations-policy.json{"description":"SmartAccountUSDCLimits","scope":"account","rules":[{"action":"accept","operation":"prepareUserOperation","criteria":[{"type":"evmNetwork","networks":["base"],"operator":"in"},{"type":"evmAddress","addresses":["0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"],"operator":"in"},{"type":"evmData","abi":"erc20","conditions":[{"function":"transfer","params":[{"name":"value","operator":"<=","value":"10000"}]}]}]},{"action":"accept","operation":"sendUserOperation","criteria":[{"type":"evmAddress","addresses":["0x833589fCD6eDb6E08f4c7C32D4f71b54bdA02913"],"operator":"in"},{"type":"evmData","abi":"erc20","conditions":[{"function":"transfer","params":[{"name":"value","operator":"<=","value":"10000"}]}]}]}]}```##CompleteimplementationexampleThefollowingexampleshowshowtocreateandmanagemultipleEVMpoliciesprogrammatically:<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();constpolicyId=""//PastethepolicyIDcreatedonportal.//Updatetheaccounttoaddtheaccountpolicy.constupdatedAccount=awaitcdp.evm.updateAccount({address:account.address,update:{accountPolicy:policyId,}})console.log("Updatedaccount%swithpolicy:%s",updatedAccount.address,updatedAccount.policies);//CreateanotheraccountwithpolicyimmediatelyappliedtoitconstotherAccount=awaitcdp.evm.createAccount({name:"OtherPolicyAccount",accountPolicy:policyId});console.log("Otheraccountaddress:",otherAccount.address);//CreateprojectpolicyexampleconstprojectPolicy=awaitcdp.policies.createPolicy({policy:{scope:"project",description:"ProjectTransactionLimitExample",rules:[{action:"accept",operation:"signEvmTransaction",criteria:[{type:"ethValue",ethValue:"5000000000000000000",//5ETHinweioperator:"<=",},{type:"evmAddress",addresses:["0x000000000000000000000000000000000000dEaD"],operator:"in",},],},],},});console.log("Createdprojectpolicy:",projectPolicy.id);```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvfromcdp.update_account_typesimportUpdateAccountOptionsload_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:account=awaitcdp.evm.create_account()policy_id=""#PastethepolicyIDcreatedonportal.updatedAccount=awaitcdp.evm.update_account(address=account.address,update=UpdateAccountOptions(account_policy=policy_id,),)print(f"Updatedaccount{account.address}withpolicy{updatedAccount.policies}")#Createanotheraccountwithpolicyimmediatelyappliedtoitother_account=awaitcdp.evm.create_account(name="OtherPolicyAccount",account_policy=policy_id,)print(f"Otheraccountaddress:{other_account.address}");#Createprojectpolicyexampleproject_policy=awaitcdp.policies.create_policy(policy=CreatePolicyOptions(scope="project",description="ProjectTransactionLimitExample",rules=[SignEvmTransactionRule(action="accept",criteria=[EthValueCriterion(ethValue="5000000000000000000",#5ETHinweioperator="<=",),EvmAddressCriterion(addresses=["0x000000000000000000000000000000000000dEaD"],operator="in",),],)],))print(f"Createdprojectpolicy:{project_policy.id}")asyncio.run(main())````</CodeGroup>#TransferringtokensfromaCDPWallet##OverviewA**transfer**referstosendingtokensfromoneaccounttoanotheronablockchainnetwork.TokentransfersaresupportedonEVMAccounts,EVMSmartAccountsandSolanaAccounts.EVMAccountscantransfernativeETHorERC-20tokens,andSolanaAccountscantransfernativeSOLorSPLtokens.##Prerequisites-Python3.10+orNode.js20+-CDPAPIcredentials(Seethe[Quickstart](/server-wallets/v2/introduction/quickstart#create-keys)guideformoreinformation)-Requiredpackages:<CodeGroup>```bashTypeScriptlineswrapnpminstall@coinbase/cdp-sdkviem``````bashPythonlineswrappipinstallcdp-sdkweb3```</CodeGroup>Ifyou'reusingSolana,you'llwanttoinstall`@solana/web3.js`insteadof`viem`onTypeScript,and`solana`insteadof`web3`onPython:<CodeGroup>```bashTypeScriptlineswrapnpminstall@coinbase/cdp-sdk@solana/web3.js``````bashPythonlineswrappipinstallcdp-sdksolana```</CodeGroup><Tip>Ifyoucompletethe[Quickstart](/server-wallets/v2/introduction/quickstart),youwillhaveacompleteworkingsetuptocompletethistutorial.</Tip>##EVMAccounttransferThissectionwillwalkyouthroughtransferringfundsfromanexternallyownedaccount(EOA).###1.CreateaccountsFirst,createtwoEOAs:<CodeGroup>```tsTypeScriptlineswrapconstsender=awaitcdp.evm.getOrCreateAccount({name:"Sender"});constreceiver=awaitcdp.evm.getOrCreateAccount({name:"Receiver"});``````pythonPythonlineswrapsender=awaitcdp.evm.get_or_create_account(name="Sender")receiver=awaitcdp.evm.get_or_create_account(name="Receiver")```</CodeGroup>###2.TransferETHtoaccountNext,transferETHusingtheaccountsyoucreatedearlier.<CodeGroup>```tsTypeScriptlineswrapimport{parseEther}from"viem";const{transactionHash}=awaitsender.transfer({to:receiver,amount:parseEther("0.00001"),token:"eth",network:"base-sepolia"});```````pythonPythonlineswrapfromweb3importWeb3tx_hash=awaitsender.transfer(to=receiver,amount=Web3.toWei("0.00001","ether"),token="eth",network="base-sepolia")````</CodeGroup>###3.WaitfortransferresultFinally,waitforthetransfertobeconfirmed.<CodeGroup>```tsTypeScriptlineswrapimport{createPublicClient,http}from"viem";import{baseSepolia}from"viem/chains";constpublicClient=createPublicClient({chain:baseSepolia,transport:http(),});constreceipt=awaitpublicClient.waitForTransactionReceipt({hash:transactionHash,});```````pythonPythonlineswrapfromweb3importWeb3w3=Web3(Web3.HTTPProvider("https://sepolia.base.org"))receipt=w3.eth.wait_for_transaction_receipt(tx_hash)````</CodeGroup>##SmartAccounttransferThissectionwillwalkyouthroughtransferringfundsfromaSmartAccounttoanEOA.###1.CreateSmartAccountFirst,wecreateanowneraccounttoassigntoournewlycreatedSmartAccount:<CodeGroup>```tsTypeScriptlineswrapconstsender=awaitcdp.evm.createSmartAccount({owner:awaitcdp.evm.getOrCreateAccount({name:"Owner"})});``````pythonPythonlineswrapowner=awaitcdp.evm.get_or_create_account(name="Owner")sender=awaitcdp.evm.create_smart_account(owner=owner)```</CodeGroup>###2.CreatereceiveraccountCreateareceiveraccount:<CodeGroup>```tsTypeScriptlineswrapconstreceiver=awaitcdp.evm.getOrCreateAccount({name:"Receiver"});``````pythonPythonlineswrapreceiver=awaitcdp.evm.get_or_create_account(name="Receiver")```</CodeGroup>###3.TransferETHtoaccountPerformthetransferusingthesmartaccount:<CodeGroup>```tsTypeScriptlineswrapimport{parseEther}from"viem";const{userOpHash}=awaitsender.transfer({to:receiver,amount:parseEther("0.00001"),token:"eth",network:"base-sepolia"});```````pythonPythonfromweb3importWeb3transfer_result=awaitsender.transfer(to=receiver,amount=Web3.toWei("0.00001","ether"),token="eth",network="base-sepolia")````</CodeGroup>###4.WaitfortransferresultFinally,waitforthetransfertobeconfirmed.<CodeGroup>```tsTypeScriptlineswrapconstreceipt=awaitsender.waitForUserOperation({userOpHash,});``````pythonPythonlineswrapreceipt=awaitsender.wait_for_user_operation(user_op_hash=transfer_result.user_op_hash)```</CodeGroup>##SolanaAccounttransferThissectionwillwalkyouthroughtransferringfundsfromaSolanaAccount.###1.CreateaccountsFirst,createtwoSolanaAccounts:<CodeGroup>```tsTypeScriptlineswrapconstsender=awaitcdp.solana.getOrCreateAccount({name:"Sender"});constreceiver=awaitcdp.solana.getOrCreateAccount({name:"Receiver"});``````pythonPythonlineswrapsender=awaitcdp.solana.get_or_create_account(name="Sender")receiver=awaitcdp.solana.get_or_create_account(name="Receiver")```</CodeGroup>###2.TransferSOLtoaccountPerformthetransferusingtheSolanaAccount:<CodeGroup>```tsTypeScriptlineswrapimport{LAMPORTS_PER_SOL}from"@solana/web3.js";const{signature}=awaitsender.transfer({to:receiver,amount:0.0001\*LAMPORTS_PER_SOL,token:"sol",network:"devnet",});```````pythonPythonlineswrapfromsolana.constantsimportLAMPORTS_PER_SOLsignature=awaitsender.transfer(to=receiver,amount=0.0001*LAMPORTS_PER_SOL,token="sol",network="devnet",)````</CodeGroup>###3.WaitfortransferresultFinally,waitforthetransfertobeconfirmed.<CodeGroup>```tsTypeScriptlineswrapconstconnection=newConnection("https://api.devnet.solana.com");const{blockhash,lastValidBlockHeight}=awaitconnection.getLatestBlockhash();constconfirmation=awaitconnection.confirmTransaction({signature,blockhash,lastValidBlockHeight,},"confirmed");if(confirmation.value.err){console.log(`Somethingwentwrong!Error:${confirmation.value.err.toString()}`);}else{console.log(`Transactionconfirmed:Link:https://explorer.solana.com/tx/${signature}?cluster=devnet`);}```````pythonPythonlineswrapfromsolana.rpc.apiimportClientasSolanaClientconnection=SolanaClient("https://api.devnet.solana.com")last_valid_block_height=connection.get_latest_blockhash()confirmation=connection.confirm_transaction(tx_sig=signature,last_valid_block_height=last_valid_block_height.value.last_valid_block_height,commitment="confirmed",)ifconfirmation.value[0].err:print(f"Somethingwentwrong!Error:{confirmation.value.err.toString()}")else:print(f"Transactionconfirmed!Link:https://explorer.solana.com/tx/{signature}?cluster=devnet")````</CodeGroup>##CompleteexampleAcomplete,runnableexamplecanbefoundbelow.Inthecodebelow,we:1.CreatetwoEVMEOAs2.TransferETHfromoneEOAtoanother3.Waitforthetransfertobeconfirmed4.CreateaSmartAccount5.TransferETHfromtheSmartAccounttoanEOA6.Waitforthetransfertobeconfirmed7.CreatetwoSolanaAccounts8.TransferSOLfromoneSolanaAccounttoanother9.Waitforthetransfertobeconfirmed<CodeGroup>```tsTypeScript[expandable]lineswrapimport{CdpClient}from'@coinbase/cdp-sdk';import{parseEther,createPublicClient,http}from'viem';import{baseSepolia}from'viem/chains';import{Connection}from'@solana/web3.js';constpublicClient=createPublicClient({chain:baseSepolia,transport:http(),});constconnection=newConnection("https://api.devnet.solana.com");asyncfunctionsendTransferWithEVMAccount(cdp:CdpClient):Promise<void>{console.log("\n===EOAExample===");constsender=awaitcdp.evm.getOrCreateAccount({name:"Sender"});constreceiver=awaitcdp.evm.getOrCreateAccount({name:"Receiver"});console.log(`Transferring0.00001ETHfrom${sender.address}to${receiver.address}...`);const{transactionHash}=awaitsender.transfer({to:receiver,amount:parseEther("0.00001"),token:"eth",network:"base-sepolia"});constreceipt=awaitpublicClient.waitForTransactionReceipt({hash:transactionHash,});console.log(`Transferstatus:${receipt.status}`);console.log(`Explorerlink:https://sepolia.basescan.org/tx/${receipt.transactionHash}`);}asyncfunctionsendTransferWithSmartAccount(cdp:CdpClient):Promise<void>{console.log("\n===SmartAccountExample===");constsender=awaitcdp.evm.createSmartAccount({owner:awaitcdp.evm.getOrCreateAccount({name:"Owner"})});constreceiver=awaitcdp.evm.getOrCreateAccount({name:"Receiver"});console.log(`Transferring0.00001ETHfrom${sender.address}to${receiver.address}...`);const{userOpHash}=awaitsender.transfer({to:receiver,amount:parseEther("0.00001"),token:"eth",network:"base-sepolia"});constreceipt=awaitsender.waitForUserOperation({userOpHash,});console.log(`Transferstatus:${receipt.status}`);console.log(`Explorerlink:https://sepolia.basescan.org/tx/${transactionHash}`);}asyncfunctionsendTransferWithSolanaAccount(cdp:CdpClient):Promise<void>{console.log("\n===SolanaAccountExample===");constsender=awaitcdp.solana.getOrCreateAccount({name:"Sender"});constreceiver=awaitcdp.solana.getOrCreateAccount({name:"Receiver"});console.log(`Transferring0.0001SOLfrom${sender.address}to${receiver.address}...`);const{signature}=awaitsender.transfer({to:receiver,amount:0.0001\*LAMPORTS_PER_SOL,token:"sol",network:"devnet",});const{blockhash,lastValidBlockHeight}=awaitconnection.getLatestBlockhash();constconfirmation=awaitconnection.confirmTransaction({signature,blockhash,lastValidBlockHeight,},"confirmed");if(confirmation.value.err){console.log(`Somethingwentwrong!Error:${confirmation.value.err.toString()}`);}else{console.log(`Transactionconfirmed:Link:https://explorer.solana.com/tx/${signature}?cluster=devnet`);}}asyncfunctionmain():Promise<void>{constcdp=newCdpClient();try{awaitsendTransferWithEVMAccount(cdp);awaitsendTransferWithSmartAccount(cdp);awaitsendTransferWithSolanaAccount(cdp);}catch(error){console.error('Error:',error);}}if(require.main===module){main().catch(console.error);}```````pythonPython[expandable]lineswrapimportasyncioimportosfromcdpimportCdpClientfromsolana.rpc.apiimportClientasSolanaClientfromweb3importWeb3w3=Web3(Web3.HTTPProvider("https://sepolia.base.org"))solana_client=SolanaClient("https://api.devnet.solana.com")asyncdefsend_transfer_with_EVM_account(cdp):print("\n===EOAExample===")sender=awaitcdp.evm.get_or_create_account(name="Sender")receiver=awaitcdp.evm.get_or_create_account(name="Receiver")print(f"Transferring0.00001ETHfrom{sender.address}to{receiver.address}...")tx_hash=awaitsender.transfer(to=receiver,amount=Web3.toWei("0.00001","ether"),token="eth",network="base-sepolia")receipt=w3.eth.wait_for_transaction_receipt(tx_hash)print(f"Transferstatus:{receipt.status}")print(f"Explorerlink:https://sepolia.basescan.org/tx/{transfer_result.transaction_hash}")asyncdefsend_transfer_with_smart_account(cdp):print("\n===SmartAccountExample===")owner=awaitcdp.evm.get_or_create_account(name="Owner")sender=awaitcdp.evm.create_smart_account(owner=owner)receiver=awaitcdp.evm.get_or_create_account(name="Receiver")print(f"Transferring0.00001ETHfrom{sender.address}to{receiver.address}...")transfer_result=awaitsender.transfer(to=receiver,amount=Web3.toWei("0.00001","ether"),token="eth",network="base-sepolia")user_op_result=awaitsender.wait_for_user_operation(user_op_hash=transfer_result.user_op_hash)print(f"Transferstatus:{user_op_result.status}")print(f"Explorerlink:https://sepolia.basescan.org/tx/{user_op_result.transaction_hash}")asyncdefsend_transfer_with_solana_account(cdp):print("\n===SolanaAccountExample===")sender=awaitcdp.solana.get_or_create_account(name="Sender")receiver=awaitcdp.solana.get_or_create_account(name="Receiver")print(f"Transferring0.0001SOLfrom{sender.address}to{receiver.address}...")signature=awaitsender.transfer(to=receiver,amount=0.0001*LAMPORTS_PER_SOL,token="sol",network="devnet",)last_valid_block_height=solana_client.get_latest_blockhash()confirmation=solana_client.confirm_transaction(tx_sig=signature,last_valid_block_height=last_valid_block_height.value.last_valid_block_height,commitment="confirmed",)ifconfirmation.value[0].err:print(f"Somethingwentwrong!Error:{confirmation.value.err.toString()}")else:print(f"Transactionconfirmed!Link:https://explorer.solana.com/tx/{signature}?cluster=devnet")asyncdefmain():asyncwithCdpClient(api_key_id=os.getenv("CDP_API_KEY_ID"),api_key_secret=os.getenv("CDP_API_KEY_SECRET"),wallet_secret=os.getenv("CDP_WALLET_SECRET"))ascdp:awaitsend_transfer_with_EVM_account(cdp)awaitsend_transfer_with_smart_account(cdp)awaitsend_transfer_with_solana_account(cdp)if__name__=="__main__":asyncio.run(main())````</CodeGroup>Afterrunningthecompleteexample,youshouldseethefollowing:```consolelineswrap===EOAExample===Transferring0.00001ETHfrom0x689c59617D8Ec93a114E2304cC038bB8678775C7to0xe4026d8D0fA814379042f1E245096F0551931d14...Transferstatus:successExplorerlink:https://sepolia.basescan.org/tx/0xdaa53830fb62f407dfe65c6e10bac6c9af1fb2014551d107f7d9de2055914985===SmartAccountExample===Transferring0.00001ETHfrom0xC3c2D7879B31Aca4e26D16AD57D07422E4a23A67to0xe4026d8D0fA814379042f1E245096F0551931d14...Transferstatus:completeExplorerlink:https://sepolia.basescan.org/tx/0x045e29f40897dc01b50a6ba0d7c3d0a424fbca69792869f56e1321f1a899419f===SolanaAccountExample===Transferring0.0001SOLfromDYjMQTJCcqmtdMvagJvW17U7teg8caUQ92nSrcXdqSZGto32gPVc5gDvn2T5EgV81NFavDMpf5HU4oLUbmuipKpV8C...Transactionconfirmed!Link:https://explorer.solana.com/tx/4KEPbhkRLTg2FJNqV5bbUd6zv1TNkksxF9PDHw2FodrTha3jq2Cojn4hSKtjPWdrZiRDuYp7okRuc1oYvh3JkLuE?cluster=devnet```##TransferringERC-20TokensorSPLTokensIntheexamplesabove,wetransferrednativetokens(`eth`and`sol`).Usingthe`transfer`method,youcanalsoeasilytransferERC-20tokensorSPLtokens,likeUSDC.The`transfer`methoditselfcanreceive`usdc`asthevalueforthe`token`parameter:<CodeGroup>```tsTypeScriptlineswrapawaitsender.transfer({to:receiver,amount:10000n,//equivalentto0.01USDCtoken:"usdc",network:"base-sepolia"})``````pythonPythonlineswrapawaitsender.transfer(to=receiver,amount=10000,#equivalentto0.01USDCtoken="usdc",network="base-sepolia")```</CodeGroup>Noticethevaluepassedtothe`amount`parameterisspecifiedas`10000`forUSDC.ThisisbecauseUSDChas6decimalplaces,so`10000`isequivalentto`0.01USDC`.Toworkwithmorehuman-readablevalues,youcanusethe`parseUnits`functionfrom`viem`ifusingTypeScript,orCDP's`parse_units`functionifusingPython:<CodeGroup>```tsTypeScriptlineswrapimport{parseUnits}from"viem";awaitsender.transfer({to:receiver,amount:parseUnits("0.01",6),//equivalentto10000ntoken:"usdc",network:"base-sepolia"})```````pythonPythonlineswrapfromcdpimportparse_unitsawaitsender.transfer(to=receiver,amount=parse_units("0.01",6),#equivalentto10000token="usdc",network="base-sepolia")````</CodeGroup>The`transfer`methodcanalsoreceiveanarbitrarytokencontractaddressasthevalueforthe`token`parameter:<CodeGroup>```tsTypeScriptlineswrapawaitsender.transfer({to:receiver,amount:parseEther("0.00001"),token:"0x4200000000000000000000000000000000000006",//ContractaddressofWETHonBaseSepolianetwork:"base-sepolia"})``````pythonPythonlineswrapawaitsender.transfer(to=receiver,amount=Web3.toWei("0.00001","ether"),token="0x4200000000000000000000000000000000000006",#ContractaddressofWETHonBaseSepolianetwork="base-sepolia")```</CodeGroup>#TokenBalances##OverviewWithCDPAPIandSDKs,youcanretrievetokenbalancesforanyaddressonsupportedEVMnetworksandSolana.Thisallowsyoutocheckbalancesforbothnativetokens(likeETH,SOL)andERC-20/SPLtokensacrossmultipleblockchainnetworks.ThetokenbalanceAPIssupportqueryingbalancesfor:-**EVMNetworks**:Ethereum,Base,andBaseSepolia-**SolanaNetworks**:SolanaMainnetandSolanaDevnet<Info>Tokenbalancequeriesare**read-onlyoperations**anddonotrequireaccountownership.Youcancheckbalancesforanypublicaddress.</Info>##EVMTokenBalancesUsethe`listTokenBalances`methodtoretrievetokenbalancesforanyEVMaddress.Thismethodreturnsbothnativetokens(likeETH)andERC-20tokensheldbytheaddress.###BasicUsage<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constresult=awaitcdp.evm.listTokenBalances({address:"0x5b76f5B8fc9D700624F78208132f91AD4e61a1f0",network:"base-sepolia",});console.log(`Found${result.balances.length}tokenbalances:`);for(constbalanceofresult.balances){console.log("Tokencontractaddress:",balance.token.contractAddress);console.log("Balanceamount:",balance.amount.amount);console.log("Balancedecimals:",balance.amount.decimals);console.log("---");}```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:token_balances=awaitcdp.evm.list_token_balances(address="0x5b76f5B8fc9D700624F78208132f91AD4e61a1f0",network="base-sepolia",)print(f"Found{len(result.balances)}tokenbalances:")forbalanceintoken_balances.balances:print(f"Tokencontractaddress:{balance.token.contract_address}")print(f"Balanceamount:{balance.amount.amount}")print(f"Balancedecimals:{balance.amount.decimals}")print("---")asyncio.run(main())````</CodeGroup>###SupportedNetworksTheEVMtokenbalanceAPIsupportsthefollowingnetworks:-**Mainnet**:`ethereum`,`base`-**Testnet**:`base-sepolia`###PaginationForaddresseswithmanytokenbalances,youcanusepaginationtoretrieveresultsinmanageablechunks:<CodeGroup>```tsTypeScriptlineswrap//GetthefirstpageoftokenbalancesconstfirstPage=awaitcdp.evm.listTokenBalances({address:"0x5b76f5B8fc9D700624F78208132f91AD4e61a1f0",network:"base-sepolia",pageSize:10,});console.log("Firstpageresults:");for(constbalanceoffirstPage.balances){console.log("Tokencontractaddress:",balance.token.contractAddress);console.log("Balanceamount:",balance.amount.amount);console.log("Balancedecimals:",balance.amount.decimals);console.log("---");}//Getthenextpageifavailableif(firstPage.nextPageToken){constsecondPage=awaitcdp.evm.listTokenBalances({address:"0x5b76f5B8fc9D700624F78208132f91AD4e61a1f0",network:"base-sepolia",pageSize:10,pageToken:firstPage.nextPageToken,});console.log("\nSecondpageresults:");for(constbalanceofsecondPage.balances){console.log("Tokencontractaddress:",balance.token.contractAddress);console.log("Balanceamount:",balance.amount.amount);console.log("Balancedecimals:",balance.amount.decimals);console.log("---");}}```````pythonPythonlineswrap#Getthefirstpageoftokenbalancesfirst_page=awaitcdp.evm.list_token_balances(address="0x5b76f5B8fc9D700624F78208132f91AD4e61a1f0",network="base-sepolia",page_size=10,)print("Firstpageresults:")forbalanceinfirst_page.balances:print(f"Tokencontractaddress:{balance.token.contract_address}")print(f"Balanceamount:{balance.amount.amount}")print(f"Balancedecimals:{balance.amount.decimals}")print("---")#Getthenextpageifavailableiffirst_page.next_page_token:second_page=awaitcdp.evm.list_token_balances(address="0x5b76f5B8fc9D700624F78208132f91AD4e61a1f0",network="base-sepolia",page_size=10,page_token=first_page.next_page_token,)print("\nSecondpageresults:")forbalanceinsecond_page.balances:print(f"Tokencontractaddress:{balance.token.contract_address}")print(f"Balanceamount:{balance.amount.amount}")print(f"Balancedecimals:{balance.amount.decimals}")print("---")````</CodeGroup>##SolanaTokenBalancesUsethe`listTokenBalances`methodtoretrievetokenbalancesforanySolanaaddress.ThismethodreturnsbothnativeSOLandSPLtokensheldbytheaddress.###BasicUsage<CodeGroup>```tsTypeScriptlineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constresult=awaitcdp.solana.listTokenBalances({address:"4PkiqJkUvxr9P8C1UsMqGN8NJsUcep9GahDRLfmeu8UK",network:"solana-devnet",});console.log(`Found${result.balances.length}tokenbalances:`);for(constbalanceofresult.balances){console.log("Tokenmintaddress:",balance.token.mintAddress);console.log("Balanceamount:",balance.amount.amount);console.log("Balancedecimals:",balance.amount.decimals);console.log("---");}```````pythonPythonlineswrapimportasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():asyncwithCdpClient()ascdp:result=awaitcdp.solana.list_token_balances(address="4PkiqJkUvxr9P8C1UsMqGN8NJsUcep9GahDRLfmeu8UK",network="solana-devnet",)print(f"Found{len(result.balances)}tokenbalances:")forbalanceinresult.balances:print("Tokenmintaddress:",balance.token.mint_address)print("Balanceamount:",balance.amount.amount)print("Balancedecimals:",balance.amount.decimals)print("---")````</CodeGroup>###SupportedNetworksTheSolanatokenbalanceAPIsupportsthefollowingnetworks:-**Mainnet**:`solana`-**Devnet**:`solana-devnet`###PaginationForaddresseswithmanytokenbalances,youcanusepagination:<CodeGroup>```tsTypeScriptlineswrap//GetthefirstpageoftokenbalancesconstfirstPage=awaitcdp.solana.listTokenBalances({address:"4PkiqJkUvxr9P8C1UsMqGN8NJsUcep9GahDRLfmeu8UK",network:"solana-devnet",pageSize:3,});console.log("Firstpage:");for(constbalanceoffirstPage.balances){console.log("Tokenmintaddress:",balance.token.mintAddress);console.log("Balanceamount:",balance.amount.amount);console.log("Balancedecimals:",balance.amount.decimals);console.log("---");}//Getthenextpageifavailableif(firstPage.nextPageToken){constsecondPage=awaitcdp.solana.listTokenBalances({address:"4PkiqJkUvxr9P8C1UsMqGN8NJsUcep9GahDRLfmeu8UK",network:"solana-devnet",pageSize:2,pageToken:firstPage.nextPageToken,});console.log("\nSecondpage:");for(constbalanceofsecondPage.balances){console.log("Tokenmintaddress:",balance.token.mintAddress);console.log("Balanceamount:",balance.amount.amount);console.log("Balancedecimals:",balance.amount.decimals);console.log("---");}}```````pythonPythonlineswrap#Getthefirstpageoftokenbalancesfirst_page=awaitcdp.solana.list_token_balances(address="4PkiqJkUvxr9P8C1UsMqGN8NJsUcep9GahDRLfmeu8UK",network="solana-devnet",page_size=3,)print("Firstpage:")forbalanceinfirst_page.balances:print("Tokenmintaddress:",balance.token.mint_address)print("Balanceamount:",balance.amount.amount)print("Balancedecimals:",balance.amount.decimals)print("---")#Getthenextpageifavailableiffirst_page.next_page_token:second_page=awaitcdp.solana.list_token_balances(address="4PkiqJkUvxr9P8C1UsMqGN8NJsUcep9GahDRLfmeu8UK",network="solana-devnet",page_size=2,page_token=first_page.next_page_token,)print("\nSecondpage:")forbalanceinsecond_page.balances:print("Tokenmintaddress:",balance.token.mint_address)print("Balanceamount:",balance.amount.amount)print("Balancedecimals:",balance.amount.decimals)print("---")````</CodeGroup>##WorkingwithYourOwnAccountsIfyouwanttocheckbalancesforaccountsyou'vecreatedwiththeCDPSDK,youcaneasilygettheaddressfromyouraccountobject:<CodeGroup>```tsTypeScriptlineswrap//Createorgetanexistingaccountconstaccount=awaitcdp.evm.getOrCreateAccount({name:"my-account"});//Checktheaccount'stokenbalancesconstbalances=awaitcdp.evm.listTokenBalances({address:account.address,network:"base-sepolia",});```````pythonPythonlineswrap#Createorgetanexistingaccountaccount=awaitcdp.evm.get_or_create_account(name="my-account")#Checktheaccount'stokenbalancesbalances=awaitcdp.evm.list_token_balances(address=account.address,network="base-sepolia",)````</CodeGroup>##ResponseFormatThetokenbalanceresponseincludesdetailedinformationabouteachtoken:###EVMTokenBalanceResponse```json{"balances":[{"token":{"contractAddress":"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48","network":"ethereum","symbol":"USDC","name":"USDC",},"amount":{"amount":1000000,"decimals":6}}],"nextPageToken":"..."}```###SolanaTokenBalanceResponse```json{"balances":[{"token":{"mintAddress":"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v","symbol":"USDC","name":"USDC",},"amount":{"amount":1000000,"decimals":6}}],"nextPageToken":"..."}```#ServerWalletUSDCRewards##OverviewEligibledeveloperscanearn4.1%rewardsontheirUSDCsimplybyholdingitinwalletscreatedusingtheCDPServerWallet.Currently,rewardsareavailabletoUS-basedindividualsandbusinesseswhomaintainanaveragedailybalanceofatleast500USDCintheirCDPWalletsoveramonth.RewardsarepaidinUSDCthefollowingmonthtothedeveloper'sCoinbase(RetailorBusiness)account.<Tip>ToreceiveUSDCRewards,youmusthavepreviouslyheldaUSDCbalanceinyourCoinbase(RetailorBusiness)account.</Tip>##USDCrewardsdetails-USDCRewardsisaloyaltyprogramfundedbyCoinbase.It’sarewardforusingCoinbaseservicestostoreUSDC.-USDCrewardsareavailableforbalancesheldinCDPWalletsonanysupportedEVMnetwork;weareworkingtoaddSolanasupport.-CoinbasehasnorighttouseanyUSDCinyourCDPWallet.-WereservetherighttochangeordiscontinueUSDCRewardsatanytimebyreasonablemeansofnotice.-USDCRewardsareintendedforthedeveloper,andmaynotbemarketedtowardorusedtoincentivizeadeveloper'send-users.Afteryouholdabalanceofatleast500USDCinyourwalletforonemonth,youwillreceiveyourrewardsthefollowingmonthinyourCoinbase(RetailorBusiness)account.#ServerWalletUSDCRewards##OverviewEligibledeveloperscanearn4.1%rewardsontheirUSDCsimplybyholdingitinwalletscreatedusingtheCDPServerWallet.Currently,rewardsareavailabletoUS-basedindividualsandbusinesseswhomaintainanaveragedailybalanceofatleast500USDCintheirCDPWalletsoveramonth.RewardsarepaidinUSDCthefollowingmonthtothedeveloper'sCoinbase(RetailorBusiness)account.<Tip>ToreceiveUSDCRewards,youmusthavepreviouslyheldaUSDCbalanceinyourCoinbase(RetailorBusiness)account.</Tip>##USDCrewardsdetails-USDCRewardsisaloyaltyprogramfundedbyCoinbase.It’sarewardforusingCoinbaseservicestostoreUSDC.-USDCrewardsareavailableforbalancesheldinCDPWalletsonanysupportedEVMnetwork;weareworkingtoaddSolanasupport.-CoinbasehasnorighttouseanyUSDCinyourCDPWallet.-WereservetherighttochangeordiscontinueUSDCRewardsatanytimebyreasonablemeansofnotice.-USDCRewardsareintendedforthedeveloper,andmaynotbemarketedtowardorusedtoincentivizeadeveloper'send-users.Afteryouholdabalanceofatleast500USDCinyourwalletforonemonth,youwillreceiveyourrewardsthefollowingmonthinyourCoinbase(RetailorBusiness)account.#UsingSmartAccounts##Overview[Smartaccounts](/server-wallets/v2/introduction/accounts#smart-accounts)areatypeofaccountthatcanbeusedtoexecuteuseroperationsonchain.Inthisguide,youwilllearnhowto:-CreateanEVMsmartaccount-Sendauseroperationfromthesmartaccount-Batchcallswithinasingleuseroperation<Note>Smartaccountscurrentlyhavethefollowinglimitations:-AnEVMaccountcanbetheownerofonlyonesmartaccount.-Asmartaccountcanonlyhaveoneowner.-Useroperationsmustbesentsequentially,notconcurrently.Asingleuseroperationcancontainmultiplecalls.</Note>##PrerequisitesItisassumedyouhavealreadycompletedthe[Quickstart](/server-wallets/v2/introduction/quickstart)guide.##1.CreateasmartaccountAn**EVMsmartaccount**isasmartcontractaccountdeployedonanEVMcompatiblenetworkthatprovidestheabilitytobatchtransactions,sponsorgas,andmanagespendpermissions.Smartaccountsrequirean**owner**accounttosignonitsbehalf.Inthisexample,wewillonlycreatethesmartaccount,anduseaCDPEVMaccountastheowner.Notethatthesmartcontractisnotdeployeduntilthefollowingstepwhenyousubmitthefirstuseroperation.<Note>Smartaccountsarecreatedwiththe[`CREATE2`](https://eips.ethereum.org/EIPS/eip-1014)opcode,allowingustoaccessacontractaddressbeforeitisdeployed.Theactualsmartcontractisnotdeployeduntilthefirstuseroperationissubmitted.Learnmoreaboutaccountabstractioninthe[CoinbaseCryptoglossary](https://www.coinbase.com/learn/crypto-glossary/what-is-account-abstraction-and-why-is-it-important).</Note><CodeGroup>```tsmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();constsmartAccount=awaitcdp.evm.createSmartAccount({owner:account,});console.log(`Createdsmartaccount:${smartAccount.address}.Owneraddress:${account.address}`);```````pythonmain.pylineswrapimportasynciofromcdpimportCdpClientimportdotenvdotenv.load_dotenv()asyncdefmain():cdp=CdpClient()account=awaitcdp.evm.create_account()smart_account=awaitcdp.evm.create_smart_account(account)print(f"Createdsmartaccount:{smart_account.address}")awaitcdp.close()asyncio.run(main())````</CodeGroup>Afterrunningtheabovesnippet,youshouldseeoutputsimilartothefollowing:```consolelineswrapCreatedsmartaccount:0x7a3D84055994c3062819Ce8730869D0aDeA4c3Bf```##2.Senda[useroperation](https://www.erc4337.io/docs/understanding-ERC-4337/user-operation)Auseroperationisatransactionthatisexecutedbyasmartaccount.Inthisexample,wewill:-Createan[externallyownedaccount](/server-wallets/v2/introduction/accounts#externally-owned-accounts)-CreateasmartaccountwiththeEOAastheowner-SubmitauseroperationonBaseSepoliafromthesmartaccountwhichtransfers0ETHtotheEOA<Note>OnBaseSepolia,smartaccountuseroperationsaresubsidized,meaningthesmartaccountdoesnotneedtobefundedwithETHtosubmitauseroperation.OnBasemainnet,youwillneedtofundthesmartaccountwithETHbeforeyoucansubmitauseroperation.</Note><CodeGroup>```tsmain.tslineswrap[expandable]import{CdpClient}from"@coinbase/cdp-sdk";import{parseEther}from"viem";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constowner=awaitcdp.evm.createAccount({});console.log("Createdowneraccount:",owner.address);constsmartAccount=awaitcdp.evm.createSmartAccount({owner,});console.log("Createdsmartaccount:",smartAccount.address);constresult=awaitcdp.evm.sendUserOperation({smartAccount,network:"base-sepolia",calls:[{to:"0x0000000000000000000000000000000000000000",value:parseEther("0"),data:"0x",},],});console.log("Useroperationstatus:",result.status);console.log("Waitingforuseroperationtobeconfirmed...");constuserOperation=awaitcdp.evm.waitForUserOperation({smartAccountAddress:smartAccount.address,userOpHash:result.userOpHash,});if(userOperation.status==="complete"){console.log("Useroperationconfirmed.Blockexplorerlink:",`https://sepolia.basescan.org/tx/${userOperation.transactionHash}`);}else{console.log("Useroperationfailed");}```````pythonmain.pylineswrap[expandable]importasynciofromdecimalimportDecimalfromweb3importWeb3fromcdpimportCdpClientfromcdp.evm_call_typesimportEncodedCallfromdotenvimportload_dotenvload_dotenv()asyncdefmain():cdp=CdpClient()try:#CreateEVMaccountaccount=awaitcdp.evm.create_account()print(f"Createdowneraccount:{account.address}")#CreatesmartaccountwithEVMaccountasownersmart_account=awaitcdp.evm.create_smart_account(account)print(f"Createdsmartaccount:{smart_account.address}")#Senduseroperationuser_operation=awaitcdp.evm.send_user_operation(smart_account=smart_account,calls=[EncodedCall(to=account.address,data="0x",value=Web3.to_wei(Decimal("0"),"ether"),)],network="base-sepolia",)print(f"Useroperationstatus:{user_operation.status}")#Waitforuseroperationconfirmationprint("Waitingforuseroperationtobeconfirmed...")user_operation=awaitcdp.evm.wait_for_user_operation(smart_account_address=smart_account.address,user_op_hash=user_operation.user_op_hash,)ifuser_operation.status=="complete":print(f"Useroperationconfirmed.Blockexplorerlink:https://basescan.org/tx/{user_operation.transaction_hash}")else:print("Useroperationfailed")exceptExceptionase:print(f"Error:{e}")finally:awaitcdp.close()asyncio.run(main())````</CodeGroup>Afterrunningtheabovesnippet,youshouldseesimilaroutput:````consolelineswrapCreatedowneraccount:0x088a49cAf927B8DacEFc4ccFD0D5EAdeC06F19A2Createdsmartaccount:0x929444AFfd714c260bb6695c921bEB99d1D31ff7Useroperationstatus:broadcastWaitingforuseroperationtobeconfirmed...Useroperationconfirmed.Blockexplorerlink:https://basescan.org/tx/0x8e66c974c8d1b2a75fee35e097fe9171d28c48066472bb6ed81ca81a10d3c321```````##3.BatchcallswithinasingleuseroperationAsmartaccountcanbatchmultiplecallsinasingleuseroperationthroughthe`calls`field.Inthisexample,wewill:-Createan[externallyownedaccount](/server-wallets/v2/introduction/accounts#externally-owned-accounts)-CreateasmartaccountwiththeEOAastheowner-Fundthesmartaccountusingafaucet-Submitabatchtransactionwith3calls<CodeGroup>```tsmain.tslineswrap[expandable]import{CdpClient}from"@coinbase/cdp-sdk";import{createPublicClient,http,parseEther,Calls}from"viem";import{baseSepolia}from"viem/chains";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();constsmartAccount=awaitcdp.evm.createSmartAccount({owner:account});console.log("Createdsmartaccount:",smartAccount.address);const{transactionHash}=awaitsmartAccount.requestFaucet({network:"base-sepolia",token:"eth",});constpublicClient=createPublicClient({chain:baseSepolia,transport:http(),});constfaucetTxReceipt=awaitpublicClient.waitForTransactionReceipt({hash:transactionHash,});console.log("Faucettransactionconfirmed:",faucetTxReceipt.transactionHash);constdestinationAddresses=["0xba5f3764f0A714EfaEDC00a5297715Fd75A416B7","0xD84523e4F239190E9553ea59D7e109461752EC3E","0xf1F7Bf05A81dBd5ACBc701c04ce79FbC82fEAD8b",];constcalls=destinationAddresses.map((destinationAddress)=>({to:destinationAddress,value:parseEther("0.000001"),data:"0x",}));console.log("Sendinguseroperationtothreedestinations...");const{userOpHash}=awaitsmartAccount.sendUserOperation({network:"base-sepolia",calls:callsasCalls<unknown[]>,});console.log("Waitingforuseroperationtobeconfirmed...");constuserOperationResult=awaitsmartAccount.waitForUserOperation({userOpHash,});if(userOperationResult.status==="complete"){console.log("Useroperationconfirmed.Blockexplorerlink:",`https://sepolia.basescan.org/tx/${userOperationResult.transactionHash}`);}else{console.log("Useroperationfailed.");}```````pythonmain.pylineswrap[expandable]importasynciofromdecimalimportDecimalfromweb3importWeb3fromcdpimportCdpClientfromcdp.evm_call_typesimportEncodedCallfromdotenvimportload_dotenvload_dotenv()asyncdefmain():w3=Web3(Web3.HTTPProvider("https://sepolia.base.org"))#Defaultdestinationsandamountdestinations=["0xba5f3764f0A714EfaEDC00a5297715Fd75A416B7","0xD84523e4F239190E9553ea59D7e109461752EC3E","0xf1F7Bf05A81dBd5ACBc701c04ce79FbC82fEAD8b"]amount=1000asyncwithCdpClient()ascdp:#Createnewownerandsmartaccountaccount=awaitcdp.evm.create_account()smart_account=awaitcdp.evm.create_smart_account(account)print("Createdsmartaccount:",smart_account.address)#Alwaysrequestfaucetfundsfaucet_hash=awaitcdp.evm.request_faucet(address=smart_account.address,network="base-sepolia",token="eth")w3.eth.wait_for_transaction_receipt(faucet_hash)print(f"Faucettransactionconfirmed:{faucet_hash}")#Createtheuseroperationwithmultiplecallsinitcalls=[EncodedCall(to=destination,data="0x",value=Web3.to_wei(Decimal(amount),"wei"),)fordestinationindestinations]print("Sendinguseroperationtothreedestinations...")user_operation=awaitcdp.evm.send_user_operation(smart_account=smart_account,calls=calls,network="base-sepolia",)print("Waitingforuseroperationtobeconfirmed...")user_operation=awaitcdp.evm.wait_for_user_operation(smart_account_address=smart_account.address,user_op_hash=user_operation.user_op_hash,)ifuser_operation.status=="complete":print("Useroperationconfirmed.Blockexplorerlink:",f"https://sepolia.basescan.org/tx/{user_operation.transaction_hash}")else:print("Useroperationfailed.")asyncio.run(main())````</CodeGroup>Afterrunningtheabovesnippet,youshouldseeoutputsimilartothefollowing:```consolelineswrapCreatedsmartaccount:0xA557E90004ba5406A3553897e99D1FC5A2685F6dFaucettransactionconfirmed:0xa691fcfd1dcacad1ef144461e9c2f1fc110172f0fcfe9a10cbc83e5ca2b6b610Sendinguseroperationtothreedestinations...Waitingforuseroperationtobeconfirmed...Useroperationconfirmed.Blockexplorerlink:https://sepolia.basescan.org/tx/0xd01b2089fd6d4673eae0d7629bcdf5488ff950dba2b7741b4725632f29e9f1ab```##DebugginguseroperationfailureWhenauseroperationrevertsonchain,thereasonfortherevertisincludedinitsreceipt,ifitcanbedecoded.YoucanusetheSDKtofetchtheuseroperationandinspectitsreceiptasshownbelow.<CodeGroup>```tsmain.tsconstuserOp=cdp.evm.getUserOperation({userOpHash:result.userOpHash,smartAccount:smartAccount,})console.log(userOp.receipts);```````pythonmain.pyuser_op=awaitcdp.evm.get_user_operation(smart_account.address,user_operation.user_op_hash)print(user_op.receipts)````</CodeGroup>#GasSponsorship##OverviewSmartAccountsunlocktheabilityfordeveloperstosponsorgasontheirusers'transactions.WiththeCDPSDK,it'ssimpletointegrateanypaymasterURLandcovergascostsforalltransactionsoriginatingfromyoursmartaccounts.Youcanrefertothis[guide](/paymaster/introduction/welcome)onhowtosetupaCDPPaymaster.Youcouldalsouseanyproviderofyourchoice.###Benefits:-RemovesthefrictionofrequiringuserstoholdETH-Enablesuserstointeractwithyourappimmediately-ProvidesamorefamiliarWeb2-likeexperiencefornewusers-Allowsyoutosubsidizeorfullycovertransactioncostsforyourusers-Givesyoucontroloverwhichtransactionsyouwanttosponsor##Prerequisites-ACoinbaseDeveloperPlatformaccount-Thefollowingenvironmentvariablesinyour`.env`file:```CDP_API_KEY_ID=your_api_key_idCDP_API_KEY_SECRET=your_api_key_secretCDP_WALLET_SECRET=your_wallet_secret```<Tip>NavigatetotheCDPPortaltofindorcreateyour[walletsecret],walletid,and[clientapikey]</Tip>AlluseroperationsonBaseSepoliaaresponsoredbydefault.Formainnet,youcanspecifyapaymasterofyourchoiceasfollows:<CodeGroup>```tsTypeScriptlineswrap[expandable]importdotenvfrom"dotenv";import{parseEther}from"viem";import{CdpClient}from"@coinbase/cdp-sdk";dotenv.config();constcdp=newCdpClient({apiKeyId:process.env.CDP_API_KEY_ID,apiKeySecret:process.env.CDP_API_KEY_SECRET,walletSecret:process.env.CDP_WALLET_SECRET,});constaccount=awaitcdp.evm.createAccount();constsmartAccount=awaitcdp.evm.createSmartAccount({owner:account,});constuserOperation=awaitcdp.evm.sendUserOperation({smartAccount:smartAccount,network:"base-sepolia",calls:[{to:"0x0000000000000000000000000000000000000000",value:parseEther("0"),data:"0x",},],paymasterUrl:"https://some-paymaster-url.com",});console.log("UserOperationResult:",userOperation);```````pythonPythonlineswrap[expandable]importasynciofromdecimalimportDecimalfromweb3importWeb3fromcdpimportCdpClientfromcdp.evm_call_typesimportEncodedCallfromdotenvimportload_dotenvload_dotenv()asyncdefmain():cdp=CdpClient()try:#CreateEVMaccountaccount=awaitcdp.evm.create_account()print(f"Createdowneraccount:{account.address}")#CreatesmartaccountwithEVMaccountasownersmart_account=awaitcdp.evm.create_smart_account(account)print(f"Createdsmartaccount:{smart_account.address}")#Senduseroperationuser_operation=awaitcdp.evm.send_user_operation(smart_account=smart_account,calls=[EncodedCall(to=account.address,data="0x",value=Web3.to_wei(Decimal("0"),"ether"),)],network="base",paymaster_url="https://some-paymaster-url.com",)print(f"Useroperationstatus:{user_operation.status}")#Waitforuseroperationconfirmationprint("Waitingforuseroperationtobeconfirmed...")user_operation=awaitcdp.evm.wait_for_user_operation(smart_account_address=smart_account.address,user_op_hash=user_operation.user_op_hash,)ifuser_operation.status=="complete":print(f"Useroperationconfirmed.Blockexplorerlink:https://basescan.org/tx/{user_operation.transaction_hash}")else:print("Useroperationfailed")exceptExceptionase:print(f"Error:{e}")finally:awaitcdp.close()asyncio.run(main())````</CodeGroup>Yougetupto\$100infreecreditsonCDPandyoucanapplyfor[additionalgascredits](https://docs.google.com/forms/d/1yPnBFW0bVUNLUN_w3ctCqYM9sjdIQO3Typ53KXlsS5g/viewform?edit_requested=true&pli=1)asyouscale.##CommonIssues-Iftransactionsfail,verifyyourgasestimates-Ifpaymasterfails,checkyourpaymasterclientandnetworkconfiguration-Makesureyourenvironmentvariablesareproperlysetinyour`.env`file-Verifyyou'reonthecorrectnetworkbeforeproceedingwithtransactions#SendingTransactionsThe[CDPSDK's](https://github.com/coinbase/cdp-sdk)`sendTransaction`methodhandles**gasestimation**,**noncemanagement**,**transactionsigning**,and**broadcasting**forEVMaccounts.Thismeansthatyoudon'tneedtospecifythesedetailswhenyousubmitatransactiononchain.CDP'snoncemanagementsystemensuresthatthenonceissetcorrectlyforeachtransaction,andthegaspriceisestimatedtoensurethatthetransactionissentatareasonableprice.Youcanreadmoreaboutthe`sendTransaction`APIinthe[APIReference](/api-reference/v2/rest-api/evm-accounts/send-a-transaction).<Tip>TheSendTransactionAPI,whichhandlesbothsigningandbroadcasting,iscurrentlysupportedonlyonBase,Ethereum,Avalanche,Polygon,OptimismandArbitrum.Forothernetworks,usetheSignTransactionAPIforsigningandrelyonyourownRPCURLstobroadcasttransactionsasshown[here](https://docs.cdp.coinbase.com/server-wallets/v2/evm-features/managed-mode#bring-your-own-node).</Tip>Thefollowingcodesnippetdemonstrateshowtosendatransactionusingthe`sendTransaction`method.Youcanalsorefertoourexamplecodein[Typescript](https://github.com/coinbase/cdp-sdk/blob/main/examples/typescript/evm/sendManyTransactions.ts)and[Python](https://github.com/coinbase/cdp-sdk/blob/main/examples/python/evm/send_transaction.py).<CodeGroup>```tsTypeScriptlineswrap[expandable]importdotenvfrom"dotenv";import{parseEther,createPublicClient,http}from"viem";import{baseSepolia}from"viem/chains";import{CdpClient}from"@coinbase/cdp-sdk";dotenv.config();/\*\*-ThisscriptdemonstratesusingthenewsendTransactionmethodto:-1.CreateanewethereumaccountonCDP-2.RequestETHfromCDPfaucet-3.Signandsendatransactioninasinglemethodcall.\*/asyncfunctionmain(){constcdp=newCdpClient();constpublicClient=createPublicClient({chain:baseSepolia,transport:http()});//Step1:CreateanewEVMaccountconstevmAccount=awaitcdp.evm.createAccount();console.log("SuccessfullycreatedEVMaccount:",evmAccount.address);//Step2:RequestETHfromthefaucetconstfaucetResp=awaitcdp.evm.requestFaucet({address:evmAccount.address,network:"base-sepolia",token:"eth",});//Waitforthefaucettransactiontobeconfirmedonchain.constfaucetTxReceipt=awaitpublicClient.waitForTransactionReceipt({hash:faucetResp.transactionHash,});console.log("SuccessfullyrequestedETHfromfaucet:",faucetTxReceipt.transactionHash);//Step3:SignandsendthetransactioninasinglestepwithsendTransaction.//TheAPIwillautomaticallyestimatethegaspriceanddeterminethenonce.consttxResult=awaitcdp.evm.sendTransaction({address:evmAccount.address,network:"base-sepolia",transaction:{to:"0x4252e0c9A3da5A2700e7d91cb50aEf522D0C6Fe8",//recipientaddressvalue:parseEther("0.000001"),//sending0.000001ETH},});console.log("Transactionsentsuccessfully!");console.log(`Transactionexplorerlink:https://sepolia.basescan.org/tx/${txResult.transactionHash}`,);awaitpublicClient.waitForTransactionReceipt({hash:txResult.transactionHash});console.log("Transactionconfirmed!");}main().catch(console.error);```````pythonPythonlineswrap[expandable]importasynciofromweb3importWeb3fromcdpimportCdpClientfromcdp.evm_transaction_typesimportTransactionRequestEIP1559importdotenvdotenv.load_dotenv()w3=Web3(Web3.HTTPProvider("https://sepolia.base.org"))#Thisscriptdemonstratesusingthesend_transactionAPIto:#1.CreateanEVMaccount#2.RequestETHfromthefaucet#3.Signandsendatransactioninasinglemethodcall.asyncdefmain():asyncwithCdpClient()ascdp:#Step1:CreateanEVMaccountaccount=awaitcdp.evm.create_account()print(f"Createdaccount:{account.address}")#Step2:RequestETHfromthefaucetfaucet_hash=awaitcdp.evm.request_faucet(address=account.address,network="base-sepolia",token="eth")w3.eth.wait_for_transaction_receipt(faucet_hash)print(f"Receivedfundsfromfaucetforaddress:{account.address}")#Step3:Signandsendthetransactioninasinglestepwithsend_transaction.#TheAPIwillautomaticallyestimatethegaspriceanddeterminethenonce.tx_hash=awaitcdp.evm.send_transaction(address=account.address,transaction=TransactionRequestEIP1559(to="0x0000000000000000000000000000000000000000",value=w3.to_wei(0.000001,"ether"),),network="base-sepolia",)print(f"Transactionsent!Hash:{tx_hash}")print("Waitingfortransactionconfirmation...")tx_receipt=w3.eth.wait_for_transaction_receipt(tx_hash)status="Success"iftx_receipt.status==1else"Failed"print(f"Transactionconfirmedinblock{tx_receipt.blockNumber}")print(f"Transactionstatus:{status}")asyncio.run(main())````</CodeGroup>#SwaptokenswithTradeAPI##OverviewTheServerWalletprovidesaconvenientwaytoexecuteswapsusingCDPEVMaccounts.ThisfeaturecombinesthecoreTradeAPIs(whichhandlepricediscoveryandquotecreation)withtheServerWallet'sabilitytosignandbroadcasttransactions.<Note>FordetailedinformationaboutthecoreTradeAPIs(pricediscoveryandquotecreation),seethe[TradeAPIsdocumentation](/trade-api/welcome).</Note><Info>TheTradeAPIcurrentlysupportsEthereumandBasemainnetnetworksonly.Additionalnetworksupportwillbeaddedinfutureupdates.</Info>##PrerequisitesItisassumedyouhavealreadycompletedtheServerWallet[Quickstart](/server-wallets/v2/introduction/quickstart)guideandhaveaCDPaccountreadytouse.##UsingCDPAccountsWhenusingCDPEVM[Accounts](/server-wallets/v2/introduction/accounts),weoffertwooptionsforsubmittingswaps:1.**All-in-oneswap**(recommended):Submitaswapinonecall2.**Quote,thenswap**(advanced):Createaquotefirst,thenexecutetheswap.Thisisusefulfordetailedswapinspectionorcustomlogic.<Note>Theseactionsmayreservefundsonchain,andarestrictlyrate-limited.</Note>#SpendPermissions##OverviewSpendPermissionsletyoudesignateatrustedspenderthatcanspendtokensonbehalfofyour[SmartAccount](/server-wallets/v2/evm-features/smart-accounts).Afteryousignthepermission,thespendercaninitiatetokenspendingwithinthelimitsyoudefine.Youcandefinelimitsbasedontoken,timeperiodandamount.<Warning>SmartAccountsmusthavespendpermissionsenabledatthetimeofcreation.Youcannotcreatespendpermissionsonaccountsthatwerecreatedwithoutspendpermissionsenabled.</Warning>SpendPermissionsutilizethe[SpendPermissionManagercontract](https://github.com/coinbase/spend-permissions)deployedonBaseand[othernetworks](/server-wallets/v2/evm-features/spend-permissions#supported-networks).Someusecasesthisfeatureenables:-**Subscriptionpayments**-EnablerecurringpaymentsforSaaS,contentsubscriptions,ormembershipfees-**Agenticpayments**-Controlyouragent'sspendinglimitsforautonomousoperations-**Algorithmictrading**-Allowtradingbotstoexecutetradeswithinpredefinedlimits-**Automatedpayouts**-Scheduleregulardistributionsorrewardpayments-**Allowancemanagement**-Giveteammembersorfamilycontrolledaccesstofunds-**Dollar-costaveraging**-Automateperiodicinvestmentpurchases##HowSpendPermissionsWorkTherearetwopartiesinvolvedinaSpendPermission:-**Account**-ThesmartaccountthatcreatestheSpendPermissionandapprovesitonchain.-**Spender**-TheentitythatcanspendtokensonbehalfoftheaccountwithinthelimitsdefinedbyaSpendPermission.CanbeaSmartAccountoraregularaccount.The[CDPSDK](https://github.com/coinbase/cdp-sdk)makesiteasytoworkwithSpendPermissionsaseithertheAccountorSpender,offeringmethodstocreateandmanageSpendPermissions,aswellasmethodstouseSpendPermissions.##AnatomyofaSpendPermissionThesearethemaincomponentsofaSpendPermission:-**Spender**-Theentitythatcanspendtokensonbehalfoftheaccount.-**Token**-ThetokenthattheSpendPermissionisfor,andtheamountofthattokenthattheSpenderisallowedtospend.-**TimePeriod**-ThetimeperiodforwhichtheSpendPermissionisvalid.-**Salt**-ArandomvalueusedtodifferentiatebetweenSpendPermissionswiththesameparameters.TheSDKwillgeneratearandomsaltforyou,butyoucanalsospecifyyourown.-**ExtraData**-ArbitrarydatathatcanbeusedtostoreadditionalinformationabouttheSpendPermission.Seethefollowingsectionsformoredetailsonthemaincomponents.###SpenderThespenderisspecifiedinthe`spender`fieldoftheSpendPermission.Itcanbetheaddressofanyaccount,whetherit'saSmartAccountoraregularaccount.###TokenThetokenisspecifiedinthe`token`fieldoftheSpendPermission,andtheamountallowedtospendisspecifiedinthe`allowance`field.SpendPermissionssupportbothnativetokensandERC-20tokens.WhenusingtheCDPSDK,youhavetwooptionsforspecifyingtokens:1.**Convenientshortcuts**-Use`"eth"`fornativeETHor`"usdc"`forUSDC,andtheSDKwillhandletheconversiontothecorrecttokenaddress.ThisshortcutisonlysupportedonBaseorBaseSepolia.2.**ERC-20contractaddresses**-Forothertokens,specifythetokencontractaddressasastring(e.g.,`"0x4200000000000000000000000000000000000006"`forWETH).Theamountallowedtospendisspecifiedinthe`allowance`field,usingthesmallestunitofthetoken.Forexample,ifthetokenisETH,theallowanceisspecifiedinwei,andifthetokenisUSDC,theallowanceisspecifiedinthesmallestunitofUSDC(6decimals).###TimePeriodThetimeperiodisspecifiedusingthe`periodInDays`fieldforsimpleday-basedperiods,orthe`period`,`start`and`end`fieldsformorecomplextimecontrols.The`periodInDays`fieldprovidesaconvenientwaytospecifycommontimeperiods(e.g.,`periodInDays:1`fordailylimits,`periodInDays:7`forweeklylimits).Formoreadvancedcontrol,the`start`and`end`fieldsspecifywhentheSpendPermissionisvalid.ThismeansthattheSpendercanspendtheamountspecifiedinthe`allowance`fieldafterthe`start`timeandbeforethe`end`time;attemptingtospendoutsideofthistimerangewillfail.<Info>The`period`fieldspecifiesarollingwindowoftimeinsecondsinwhichtheSpendercanspendtheamountspecifiedinthe`allowance`field.Thisallowsyouspecifythingslike"theSpendercanspendupto0.00001ETHperday"or"theSpendercanspendupto100USDCperweek".</Info>##CreatingaSpendPermissionHere'showtocreateaspendpermissionthatallowsaspendertowithdrawupto0.00001ETHperday:<Warning>CreatingSpendPermissionsiscurrentlyonlysupportedonCDPSmartAccountsownedbyCDPServerWallets.</Warning><CodeGroup>```typescriptTypeScriptimport{CdpClient,parseUnits,typeSpendPermissionInput,}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constsmartAccount=awaitcdp.evm.getOrCreateSmartAccount({name:"SmartAccount",owner:awaitcdp.evm.getOrCreateAccount({name:"Owner",}),enableSpendPermissions:true,//NOTE:SmartAccountsmusthavespendpermissionsenabledatthetimeofcreation.});constspender=awaitcdp.evm.getOrCreateSmartAccount({name:"Spender",owner:awaitcdp.evm.getOrCreateAccount({name:"Spender-Owner",}),});constspendPermission:SpendPermissionInput={account:smartAccount.address,spender:spender.address,token:"usdc",allowance:parseUnits("0.01",6),periodInDays:1,};const{userOpHash}=awaitcdp.evm.createSpendPermission({network:"base-sepolia",spendPermission,});constuserOperationResult=awaitsmartAccount.waitForUserOperation({userOpHash,});console.log("Spendpermissioncreated:",userOperationResult);```````pythonPythonfromcdpimportCdpClient,SpendPermissionfromweb3importWeb3asyncdefmain():asyncwithCdpClient(api_key_id=os.environ.get("CDP_API_KEY_ID"),api_key_secret=os.environ.get("CDP_API_KEY_SECRET"),wallet_secret=os.environ.get("CDP_WALLET_SECRET"),)ascdp:smart_account=awaitcdp.evm.get_or_create_smart_account(name="SmartAccount",owner=awaitcdp.evm.get_or_create_account(name="Owner"),enable_spend_permissions=True,)spender=awaitcdp.evm.get_or_create_account(name="Spender")result=awaitcdp.evm.create_spend_permission(network="base-sepolia",spend_permission=SpendPermission(account=smart_account.address,spender=spender.address,token="eth",allowance=parse_ether("0.00001"),period_in_days=1,),)user_operation_result=awaitcdp.evm.wait_for_user_operation(smart_account_address=smart_account.address,user_op_hash=result.user_op_hash,)print(f"Spendpermissioncreated:{user_operation_result}")if__name__=="__main__":asyncio.run(main())````</CodeGroup>###ERC-20TokenPermissionsTocreatespendpermissionsforERC-20tokensotherthanUSDC,specifythetokencontractaddress:```typescriptconstwethSpendPermission:SpendPermissionInput={account:smartAccount.address,spender:spender.address,token:"0x4200000000000000000000000000000000000006",//WETHonBaseSepoliaallowance:parseEther("0.00001"),//0.00001WETHperiodInDays:1,//Dailylimit};```##UsingaSpendPermissionOnceaspendpermissioniscreated,thedesignatedspendercanspendtokensonbehalfoftheaccountwithinthedefinedlimits:<CodeGroup>```typescriptTypeScript//ListspendpermissionstogettheactualresolvedpermissionconstallPermissions=awaitcdp.evm.listSpendPermissions({address:smartAccount.address,});constpermissions=allPermissions.spendPermissions.filter((p)=>p.permission.spender.toLowerCase()===spender.address.toLowerCase());if(permissions.length===0){console.log("Nospendpermissionsfoundforthisspender");process.exit(1);}constspend=awaitspender.useSpendPermission({spendPermission:permissions[0].permission,value:parseUnits("0.005",6),network:"base-sepolia",});constspendReceipt=awaitspender.waitForUserOperation(spend);constspendUserOp=awaitspender.getUserOperation({userOpHash:spendReceipt.userOpHash,});console.log("Spendcompleted!",`https://sepolia.basescan.org/tx/${spendUserOp.transactionHash}`);```````pythonPythonall_permissions=cdp.evm.list_spend_permissions(address=smart_account.address,)permissions=[permissionforpermissioninall_permissionsifpermission.spender.lower()==spender.address.lower()]iflen(permissions)==0:print("Nospendpermissionsfoundforthisspender")exit(1)spend=spender.use_spend_permission(spend_permission=permissions[0].permission,value=parse_units("0.005",6),network="base-sepolia")spend_receipt=spender.wait_for_user_operation(spend)print(f"Spendcompleted!https://sepolia.basescan.org/tx/{spend_receipt.transaction_hash}")````</CodeGroup>##ManagingSpendPermissions###ListingSpendPermissionsThe`listSpendPermissions`methodworksdifferentlydependingonwhetheryou'requeryingastheAccountorastheSpender:####AstheAccountWhenlistingastheAccount,youseeallspendpermissionsyou'vegrantedtovariousspenders:<CodeGroup>```typescriptTypeScriptconstpermissions=awaitcdp.evm.listSpendPermissions({address:smartAccount.address,});console.log("Spendpermissionsgrantedbythisaccount:",permissions);```````pythonPythonpermissions=cdp.evm.list_spend_permissions(address=smart_account.address,)print("Spendpermissionsgrantedbythisaccount:",permissions)````</CodeGroup>####AstheSpenderWhenlistingastheSpender,youmustqueryspendpermissionsgrantedbytheaccountwhosetokensyouwanttospend.Youcanthenfiltertheresultstofindthespendpermissionyouwanttouse.<CodeGroup>```typescriptTypeScriptconstallPermissions=awaitcdp.evm.listSpendPermissions({address:"0xDeF2Bd558190d2DE7E4b26F452C9c10A175B1f45",//Accountthatisknowntohavedesignatedthisspender});constpermissions=allPermissions.spendPermissions.filter((p)=>p.permission.spender.toLowerCase()===spender.address.toLowerCase());console.log("Spendpermissionsavailabletothisspender:",permissions);```````pythonPythonall_permissions=cdp.evm.list_spend_permissions(address="0xDeF2Bd558190d2DE7E4b26F452C9c10A175B1f45",#Accountthatisknowntohavedesignatedthisspender)permissions=[permissionforpermissioninall_permissionsifpermission.spender.lower()==spender.address.lower()]print("Spendpermissionsavailabletothisspender:",permissions)````</CodeGroup>###RevokingSpendPermissionsYoucanrevokeaSpendPermissionusingthe`revokeSpendPermission`method:<CodeGroup>```typescriptTypeScript//First,getthepermissionhashofthepermissiontorevokeconstpermissions=awaitcdp.evm.listSpendPermissions({address:account.address,});constpermissionHash=permissions.spendPermissions[0].permissionHash;awaitcdp.evm.revokeSpendPermission({address:account.address,permissionHash,network:"base-sepolia",});constrevokeResult=awaitcdp.evm.waitForUserOperation({smartAccountAddress:account.address,userOpHash:revokeUserOpHash,});console.log("Revokeresult:",revokeResult);```````pythonPython#First,getthepermissionhashofthepermissiontorevokeall_permissions=cdp.evm.list_spend_permissions(address=account.address,)permission_hash=all_permissions[0].permission_hashcdp.evm.revoke_spend_permission(address=account.address,permission_hash=permission_hash,)revoke_result=cdp.evm.wait_for_user_operation(smart_account_address=account.address,user_op_hash=revoke_user_op_hash,)print("Revokeresult:",revoke_result)````</CodeGroup>##SpendPermissionsvs.PoliciesAtitscore,aSpendPermissionenablesaspendertospendtokensonbehalfofanaccountwithinaspecifiedtimeperiodandamount.ThetokenscanbenativeETHoranERC-20token.ThissectionexploresthedifferencesbetweenSpendPermissionsand[CDPPolicies](/server-wallets/v2/using-the-wallet-api/policies/overview).||SpendPermissions|Policies||--------------------------|-----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------||**EvaluationEnvironment**|Evaluatedentirelyonchainthroughsmartcontracts,providingtransparencyanddecentralization|EvaluatedwithinCoinbase'strustedinfrastructureusingTEEtechnology,providingsecureoff-chainevaluation||**ScopeandFlexibility**|SpecificallydesignedforspendingassetsonEVMchains|Canbeappliedtoanyarbitrarytransactiontype,givingfullcontroloverallowedtransactions||**PlatformSupport**|OnlyavailableonEVMchains|AvailableonbothEVMchainsandSolana||**AccountScope**|Cangrantpermissionstoanyaccountonchain,includingaccountsoutsideyourCDPproject|GovernaccountswithinyourCDPprojectonly|##BestPractices1.**SetReasonableLimits**-Usetheminimumallowancenecessaryforyourusecase2.**DefineTimeBoundaries**-Setappropriatestartandendtimestolimitexposure3.**MonitorUsage**-Trackspendingactivitytodetectanyunusualbehavior4.**RevokeWhenNecessary**-Implementlogictorevokepermissionswhennolongerneeded##SupportedNetworksSpendPermissionsarecurrentlysupportedon:Testnets:-BaseSepolia-EthereumSepoliaMainnets:-Base-Ethereum-Optimism-Arbitrum-Polygon-Avalanche<Info>TheSpendPermissionManagercontractisdeployedat`0xf85210B21cC50302F477BA56686d2019dC9b67Ad`onallsupportednetworks.</Info>#ManagedMode##OverviewTheCDPSDKoffersasimpleandflexibleAPItoenhanceEVMAccountswithproduction-readyinfrastructure.Thisfeatureoffers:1.**AutomaticCDPNodeIntegration**:AccountsautomaticallyuseCDP'smanagedRPCendpointsandPaymasterservices2.**Network-ScopedAccountInstances**:Createnetwork-scopedaccountinstanceswith`useNetwork()`forimproveddeveloperexperience3.**BringYourOwnNode**:FlexibilitytousecustomRPCendpointsandPaymasterswhenneeded4.**EnhancedTypeSafety**:Network-scopedmethodavailabilitywithTypeScriptsupport##Network-ScopedAccountInstances###ManagingNetwork-ScopedAccountsThe`useNetwork()`methodletsyouinitializenetwork-scopedaccountinstances,helpingyouavoidrepeatedlyspecifyingthenetworkinrequests.Thisprovidesamoreintuitivedeveloperexperiencebyscopingaccountoperationstoaspecificnetwork.```typescriptmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constaccount=awaitcdp.evm.getOrCreateAccount({name:"My-Account",});//ScopeanaccountinstancetoBase.constbaseAccount=awaitaccount.useNetwork("base");//Allsubsequentoperationsautomaticallyuse"base"asthenetwork.consttransaction=awaitbaseAccount.sendTransaction({transaction:{to:"0x0000000000000000000000000000000000000000",value:0n,},});//WaitfortransactionreceiptwillautomaticallyuseyourCDPNodeRPC.constreceipt=awaitbaseAccount.waitForTransactionReceipt(transaction);console.log("Transactionconfirmed:",receipt.transactionHash);```###Network-ScopedMethodAvailabilityTheSDKenhancestypesafetybyexposingnetwork-specificmethodsbasedontheselectednetwork.Forexample,faucetfunctionalityisonlyavailableontestnets,andattemptingtouseitonamainnetwillresultinatypeerror.```typescriptmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();//BaseSepoliatestnet-supportsfaucetrequests.constbaseSepoliaAccount=awaitaccount.useNetwork("base-sepolia");//TypeScriptknowsthesemethodsareavailable.awaitbaseSepoliaAccount.listTokenBalances({});awaitbaseSepoliaAccount.requestFaucet({token:"eth"});//✅Availableontestnet//Basemainnet-doesnotsupportfaucetrequests.constbaseAccount=awaitaccount.useNetwork("base");//TypeScriptknowsthismethodisavailable.awaitbaseAccount.listTokenBalances({});//TypeScriptwoulderroronthis://awaitbaseAccount.requestFaucet({token:"eth"});//❌TypeScripterror```##BundleCDPNodeandPaymasterwithEVMAccounts###DefaultCDPNodeUsageWhenyouusenetwork-specificaccountinstanceswithBaseorBaseSepolia,theSDKautomaticallyintegrateswiththefree[CDPBaseNode](https://www.coinbase.com/developer-platform/products/base-node)offering,providing:-**ManagedRPCEndpoints**:AutomaticconnectiontoCDP'soptimizedRPCinfrastructure-**PaymasterIntegration**:Automaticgassponsorshipforsmartaccounts####ManagedRPCEndpointsThe[ManagingNetwork-ScopedAccounts](/server-wallets/v2/evm-features/managed-mode#managing-network-scoped-accounts)sectionabovedemonstrateshownetwork-scopedaccountsautomaticallyuseCDPNodeRPC.Theimportantbitsaredisplayedbelow:```typescriptmain.tslineswrap//ScopeanaccountinstancetoBase.constbaseAccount=awaitaccount.useNetwork("base");//...sendatransaction...//WaitfortransactionreceiptwillautomaticallyuseyourCDPNodeRPC.constreceipt=awaitbaseAccount.waitForTransactionReceipt(transaction);```WhenusingaccountsscopedtoBaseorBaseSepolia(i.e.calling`useNetwork("base")`or`useNetwork("base-sepolia")`),theSDKautomaticallyusestheCDPBaseNodeRPC.####PaymasterIntegrationThefollowingcodeshowshowSmartAccountsautomaticallyuseCDPPaymasterforgassponsorship.```typescriptmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constaccount=awaitcdp.evm.getOrCreateAccount({name:"My-Account",});constsmartAccount=awaitcdp.evm.getOrCreateSmartAccount({name:"My-Smart-Account",owner:account,});//ScopeanaccountinstancetoBase.constbaseSmartAccount=awaitsmartAccount.useNetwork("base");//AutomaticallyusesCDPPaymasterforgassponsorship.constuserOperation=awaitbaseSmartAccount.sendUserOperation({calls:[{to:"0x0000000000000000000000000000000000000000",value:0n,data:"0x",},],});constreceipt=awaitbaseSmartAccount.waitForUserOperation(userOperation);console.log("Useroperationconfirmed:",receipt);```<Info>**GasSponsorship**:WhenusingCDPsmartaccountsonBaseorBaseSepolia,gasfeesareautomaticallysponsoredthroughCDP'sPaymasterservice,eliminatingtheneedforaccountstoholdETHfortransactionfees.</Info>NotethatevengenericaccountscanuseCDPPaymasterforgassponsorship,justbyspecifyingBaseasthenetwork.```typescriptmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constaccount=awaitcdp.evm.getOrCreateAccount({name:"My-Account",});constsmartAccount=awaitcdp.evm.getOrCreateSmartAccount({name:"My-Smart-Account",owner:account,});//AutomaticallyusesCDPPaymasterforgassponsorship.constuserOperation=awaitsmartAccount.sendUserOperation({network:"base",calls:[{to:"0x0000000000000000000000000000000000000000",value:0n,data:"0x",},],});constreceipt=awaitsmartAccount.waitForUserOperation(userOperation);console.log("Useroperationconfirmed:",receipt);```##BringYourOwnNode###UsingCustomRPCURLsForgreatercontrolortousenetworksnotnativelysupportedbytheCDPAPI,youcanspecifycustomRPCURLswhencreatingnetwork-scopedaccountinstances.```typescriptmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constaccount=awaitcdp.evm.getOrCreateAccount({name:"My-Account",});//UseacustomRPCURLforPolygon.constpolygonAccount=awaitaccount.useNetwork("https://polygon-mainnet.rpc-provider.com/YOUR_API_KEY");//UsestheprovidedRPCURLinsteadofCDPNode.consttransaction=awaitpolygonAccount.sendTransaction({transaction:{to:"0x0000000000000000000000000000000000000000",value:0n,},});//TransactionmonitoringalsousestheprovidedRPCURL.constreceipt=awaitpolygonAccount.waitForTransactionReceipt(transaction);console.log("TransactionconfirmedoncustomRPC:",receipt.transactionHash);```<Note>WhenusingcustomRPCURLs,you'llneedtoensuretheRPCprovidersupportsthespecificnetworkandhasadequateratelimitsforyourapplication'sneeds.</Note>#EIP-191##OverviewMessagesigningallowsyoutoapplyauniquecryptographicsignaturetoverifyyouridentityonEVMnetworks.Usingthe[CDP-SDK](https://github.com/coinbase/cdp-sdk),developerscanenablesigningofmessageswiththeEIP-191standard,whichprependsmessageswithastandardprefixbeforesigning.Thisensuresmessagesareeasilydistinguishablefromtransactiondataandprovidesasecurewaytoproveownershipofanaddress.Inthisguide,youwilllearnhowto:-CreateanEVMaccount-SignamessageusingEIP-191standard##PrerequisitesItisassumedyouhavealreadycompletedthe[Quickstart](/server-wallets/v2/introduction/quickstart)guide.##1.CreateanaccountTocreateanaccount,seebelow:<CodeGroup>```tsmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();console.log("Successfullycreatedaccount:",account.address);``````pythonmain.pylineswrapimportasynciofromcdpimportCdpClientimportdotenvdotenv.load_dotenv()asyncdefmain():cdp=CdpClient()account=awaitcdp.evm.create_account()print(f"Successfullycreatedaccount:{account.address}")awaitcdp.close()asyncio.run(main())```</CodeGroup>Afterrunningtheabovesnippet,youshouldseeoutputsimilartothefollowing:```Successfullycreatedaccount:0x6aAEc7535706ce8B36ea184B2236D53702c1F06A```##2.SignmessageThev2ServerWalletsupports[EIP-191](/api-reference/v2/rest-api/evm-accounts/sign-an-eip-191-message)messagesigning,whichprovidesastandardizedwaytosignmessagesonEthereum.Perthespecification,themessageisprependedwith`\x19EthereumSignedMessage:\n`followedbythemessagelengthbeforebeingsigned.<Accordiontitle="ExpandtolearnmoreaboutEIP-191">###WhatisEIP-191?EIP-191isastandardforsigningmessagesinEthereumthathelpspreventsignedmessagesfrombeingconfusedwithsignedtransactions.Itdefinesastructuredformatforsigneddatathatincludes:-Amagicbyte`0x19`toensurethedatacouldneverbeavalidRLP-encodedtransaction-Thestring"EthereumSignedMessage:\n"-Thelengthofthemessage-Theactualmessagecontent###UseCasesEIP-191signedmessagesarecommonlyusedfor:-**Authentication**:Provingownershipofanaddresswithoutmakingatransaction-**Off-chainagreements**:Signingtermsofserviceorotheragreements-**Messageverification**:Allowingotherstoverifythataspecificaddresssignedamessage-**Loginsystems**:Implementing"SigninwithEthereum"functionality###SecurityBenefits-Messagescannotbereplayedastransactions-Clearseparationbetweentransactionsigningandmessagesigning-Human-readablemessagesinsteadofrawhashes-Protectionagainstphishingattacksbyshowinguserswhatthey'resigning</Accordion>HereisacompleteexampleshowinghowtosignamessageusingEIP-191:<CodeGroup>```tsmain.tslineswrap[expandable]import{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();console.log("Createdaccount:",account.address);constmessage="Hello,CoinbaseDeveloperPlatform!";constsignature=awaitcdp.evm.signMessage({address:account.address,message});console.log("Message:",message);console.log("Signature:",signature);//Thesignaturecanbeverifiedbyanyonetoprovetheaccountsignedthemessage```````pythonmain.pylineswrap[expandable]importasynciofromcdpimportCdpClientfromdotenvimportload_dotenvload_dotenv()asyncdefmain():cdp=CdpClient()account=awaitcdp.evm.create_account()print(f"Createdaccount:{account.address}")message="Hello,CoinbaseDeveloperPlatform!"signature=awaitcdp.evm.sign_message(address=account.address,message=message)print(f"Message:{message}")print(f"Signature:{signature}")#Thesignaturecanbeverifiedbyanyonetoprovetheaccountsignedthemessageawaitcdp.close()asyncio.run(main())````</CodeGroup>Afterrunningtheabovesnippet,youshouldseeoutputsimilartothefollowing:```Createdaccount:0x2Ae896e791c9596c7beDeCC3E06Fa6DA9aE2B193Message:Hello,CoinbaseDeveloperPlatform!Signature:0x1b0c9cf8cd4554c6c6d9e7311e88f1be075d7f25b418a044f4bf2c0a42a93e212ad0a8b54de9e0b5f7e3812de3f2c6cc79aa8c3e1c02e7ad14b4a8f42012c2c01b```Tosummarize,intheexampleabove,we:-CreatedanEVMaccount-SignedaplaintextmessageusingEIP-191standard-ThemessagewasautomaticallyprependedwiththeEIP-191prefixbeforesigning-Generatedacryptographicsignaturethatcanbeusedtoverifythesigner'sidentityTheEIP-191standardensuresthatsignedmessagescannotbeconfusedwithtransactiondata,providingasecurewaytoproveownershipofanaddress.##VerifyingSignaturesOnceyouhaveasignature,itcanbeverifiedbyanyonetoconfirmthatthemessagewassignedbytheclaimedaddress.Thisisusefulforauthenticationsystems,provingownership,orvalidatingoff-chainagreements.#EIP-712##OverviewEIP-712messagesigningallowsyoutosignstructureddatausingahuman-readableformat.Usingthe[CDP-SDK](https://github.com/coinbase/cdp-sdk),developerscanenablesigningwhilepresentingclear,meaningfulmessagestousers,ratherthanunintelligiblerawhexadecimalhashes.Inthisguide,youwilllearnhowto:-CreateanEVMaccount-SignanEIP-712message##PrerequisitesItisassumedyouhavealreadycompletedthe[Quickstart](/server-wallets/v2/introduction/quickstart)guide.##1.CreateanaccountTocreateanaccount,seebelow:<CodeGroup>```tsmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();console.log("Successfullycreatedaccount:",account.address);``````pythonmain.pylineswrapimportasynciofromcdpimportCdpClientimportdotenvdotenv.load_dotenv()asyncdefmain():cdp=CdpClient()account=awaitcdp.evm.create_account()print(f"Successfullycreatedaccount:{account.address}")awaitcdp.close()asyncio.run(main())```</CodeGroup>Afterrunningtheabovesnippet,youshouldseeoutputsimilartothefollowing:```Successfullycreatedaccount:0x6aAEc7535706ce8B36ea184B2236D53702c1F06A```##2.SignmessageThev2ServerWalletsupports[EIP-712](/api-reference/v2/rest-api/evm-accounts/sign-eip-712-typed-data)fortypedstructureddatahashingandsigning,providingawaytocreatehuman-readablemessagesthatcanbesignedandverifiedonchain.<Accordiontitle="ExpandtolearnmoreaboutEIP-712components">###DomainSeparatorThedomainseparatorisauniqueidentifierfortheapplicationorprotocol.Ithelpspreventsignaturecollisionsbetweendifferentapplications.Ittypicallyincludes:-`name`:thenameoftheapplication(e.g.,"MyApp")-`chainId`:thenetworkIDwherethesignaturewillbeverified(e.g.,1forEthereummainnet)-`verifyingContract`:theaddressofthecontractthatwillverifythesignature###TypeDefinitionsTypedefinitionsdescribethestructureofyourmessage.Theyincludetherequired`EIP712Domain`typeandyourcustomtypes.Eachcustomtypeisdefinedasanarrayoffields,whereeachfieldhasanameandtype.-EIP712Domain:requiredbasetypethatdefinesthedomainstructure-`name`(string)-`version`(string)-`chainId`(uint256)-`verifyingContract`(address)-`salt`(bytes32)-CustomTypes:yourapplication-specifictypes(e.g.,"Person")-Eachfieldhasanameandtype-Canincludenestedtypes-Mustbeproperlydefinedbeforeuse###PrimaryTypeTheprimarytypeisthemaintypeofthemessageyou'resigning.Itshouldbeoneofthetypesdefinedinyourtypedefinitions.###MessageThemessagecontainstheactualdatayouwanttosign.Itmustmatchthestructuredefinedbyyourprimarytype.</Accordion>HereisacompleteexampleshowinghowtosignEIP-712typeddata:<CodeGroup>```tsmain.tslineswrap[expandable]import{CdpClient}from"@coinbase/cdp-sdk";import"dotenv/config";constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();console.log("Createdaccount:",account.address);constsignature=awaitcdp.evm.signTypedData({address:account.address,domain:{name:"MyApp",chainId:1,verifyingContract:"0x0000000000000000000000000000000000000000",},types:{EIP712Domain:[{name:"name",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"},],Person:[{name:"name",type:"string"},{name:"age",type:"uint256"}]},primaryType:"Person",message:{name:"Alice",age:25},});console.log("Signature:",signature);```````pythonmain.pylineswrap[expandable]importasynciofromcdpimportCdpClientfromcdp.evm_message_typesimportEIP712Domainfromdotenvimportload_dotenvload_dotenv()asyncdefmain():cdp=CdpClient()account=awaitcdp.evm.create_account()print(f"Createdaccount:{account.address}")signature=awaitcdp.evm.sign_typed_data(address=account.address,domain=EIP712Domain(name="EIP712Domain",chain_id=1,verifying_contract="0x0000000000000000000000000000000000000000",).as_dict(),types={"EIP712Domain":[{"name":"name","type":"string"},{"name":"chainId","type":"uint256"},{"name":"verifyingContract","type":"address"},],"Person":[{"name":"name","type":"string"},{"name":"age","type":"uint256"}]},primary_type="Person",message={"name":"Alice","age":25},)print("Signature:",signature)awaitcdp.close()asyncio.run(main())````</CodeGroup>Afterrunningtheabovesnippet,youshouldseeoutputsimilartothefollowing:```Createdaccount:0x2Ae896e791c9596c7beDeCC3E06Fa6DA9aE2B193Signature:0xa8fdc11edcf120b116d34131159ca356af52b90732425ebec48cac125a449e7d2151d97ca8232bff43568da9ee2249cf1bc187c392f1d1e53c72fc0b5937f5b31b```Tosummarize,intheexampleabove,we:-CreatedanEVMaccount-SignedamessageusingEIP-712structureddata,whichincludes:adomainseparator,typedefinitions,primarytype,andamessagepayload(apersonnamedAlicewhois25yearsold)TheEIP-712structureddatawasusedtocreateahuman-readablemessagewhichwesuccessfullysignedcryptographically.#viemCompatibility##OverviewTheCDPSDKiscompatiblewith`viem`inacoupleways:1.viemLocalAccountscanbesetastheownerofaCDPSmartAccount.Seethe[SignerExample](#signer-example)below.2.CDPaccountscanbewrappedintoviemCustomAccountsusingthe`toAccount`function.Seethe[WalletClientExample](#wallet-client-example)below.##SignerExampleYoucancreateaviemLocalAccountandsetitastheownerofaCDPSmartAccount.```typescriptmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import{generatePrivateKey,privateKeyToAccount}from"viem/accounts";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constprivateKey=generatePrivateKey();constowner=privateKeyToAccount(privateKey);constsmartAccount=awaitcdp.evm.createSmartAccount({owner});```##WalletClientExampleYoucanpassaCDPaccounttothe`toAccount`functionandgetbackaviemCustomAccount,whichcanbeusedwhereverviemexpectsanaccount.Forexample,youcancreateaviem[WalletClient](#)fromthisaccountandusetheWalletClienttosendtransactions.ThefollowingcodesnippetdemonstrateshowtouseaviemWalletClienttosendatransaction.Ifyoufollowedthe[quickstart](#),youwillhaveaprojectthatyoucanusetofollowalongwiththeexamplebelow.###1.InstallviemInstall`viem`inyourproject:```bashlineswrapnpminstallviem```###2.CreateaWalletClientfromaCDPaccountHereweuse`toAccount`from`viem/accounts`towrapaCDPaccountinaviemCustomAccount,whichisimmediatelypassedtothe`createWalletClient`functiontocreateaviemWalletClient.```typescriptmain.tslineswrapimport{CdpClient}from"@coinbase/cdp-sdk";import{createWalletClient}from"viem";import{toAccount}from"viem/accounts";import{baseSepolia}from"viem/chains";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();console.log("Createdaccount:",account.address);constwalletClient=createWalletClient({account:toAccount(account),chain:baseSepolia,transport:http(),});```3.SendatransactionwiththeWalletClientNext,usetheWalletClienttosendatransaction,afterrequestingsometestnetETHfromthefaucet.```typescriptmain.ts[expandable]lineswrapimport{http,createPublicClient,parseEther}from"viem";importdotenvfrom"dotenv";dotenv.config();constcdp=newCdpClient();//...existingcode...//ThisisusedtowaitfortransactionconfirmationconstpublicClient=createPublicClient({chain:baseSepolia,transport:http(),});console.log("RequestingtestnetETHfromfaucet...");const{transactionHash:faucetTransactionHash}=awaitcdp.evm.requestFaucet({address:account.address,network:"base-sepolia",token:"eth",});console.log("Waitingforfundstoarrive...");constfaucetTxReceipt=awaitpublicClient.waitForTransactionReceipt({hash:faucetTransactionHash,});console.log("ReceivedtestnetETH");consthash=awaitwalletClient.sendTransaction({to:"0x0000000000000000000000000000000000000000",value:parseEther("0.000001"),});consttxReceipt=awaitpublicClient.waitForTransactionReceipt({hash,});console.log(`Transactionsent!Link:https://sepolia.basescan.org/tx/${hash}`);```4.PuttingitalltogetherHere'sthecompletecodefortheexampleabove.```typescriptmain.ts[expandable]lineswrapimport{CdpClient}from"@coinbase/cdp-sdk";importdotenvfrom"dotenv";import{createWalletClient,http,createPublicClient,parseEther}from"viem";import{toAccount}from"viem/accounts";import{baseSepolia}from"viem/chains";dotenv.config();constcdp=newCdpClient();constaccount=awaitcdp.evm.createAccount();console.log("Createdaccount:",account.address);constwalletClient=createWalletClient({account:toAccount(account),chain:baseSepolia,transport:http(),});//ThisisusedtowaitfortransactionconfirmationconstpublicClient=createPublicClient({chain:baseSepolia,transport:http(),});console.log("RequestingtestnetETHfromfaucet...");const{transactionHash:faucetTransactionHash}=awaitcdp.evm.requestFaucet({address:account.address,network:"base-sepolia",token:"eth",});console.log("Waitingforfundstoarrive...");constfaucetTxReceipt=awaitpublicClient.waitForTransactionReceipt({hash:faucetTransactionHash,});console.log("ReceivedtestnetETH");consthash=awaitwalletClient.sendTransaction({to:"0x0000000000000000000000000000000000000000",value:parseEther("0.000001"),});consttxReceipt=awaitpublicClient.waitForTransactionReceipt({hash,});console.log(`Transactionsent!Link:https://sepolia.basescan.org/tx/${hash}`);```#web3Compatibility##OverviewTheCDPSDKiscompatiblewiththe[eth-account](https://github.com/ethereum/eth-account)interfacetosignmessages,hashes,typeddata,andtransactions.##SignerExamplesYoucancreateaCDPServerAccountandwrapitin`EvmLocalAccount`whichistheclassthatiscompatiblewith[eth-accountsigners](https://github.com/ethereum/eth-account/tree/main/eth_account/signers).Youcancallthen`sign*`functionsontheresultingaccount.```pythonmain.py[expandable]lineswrapimportasynciofromcdpimportCdpClientfromcdp.evm_local_accountimportEvmLocalAccountfrometh_account.messagesimportencode_defunctfromweb3importWeb3importdotenvdotenv.load_dotenv()asyncdefmain():cdp=CdpClient()server_account=awaitcdp.evm.create_account()print(f"Successfullycreatedaccount:{server_account.address}")account=EvmLocalAccount(server_account)#1.Signamessagemessage="Hello,world!"signable_message=encode_defunct(text=message)signed_message=account.sign_message(signable_message)print("Signedmessage:",signed_message)#2.Signahashhash="0x1234567890123456789012345678901234567890123456789012345678901234"signed_hash=account.unsafe_sign_hash(hash)print("Signedhash:",signed_hash)#3.Signtypeddatatyped_data={"domain":{"name":"MyDomain","version":"1","chainId":1,"verifyingContract":"0x0000000000000000000000000000000000000000",},"types":{"EIP712Domain":[{"name":"name","type":"string"},{"name":"version","type":"string"},{"name":"chainId","type":"uint256"},{"name":"verifyingContract","type":"address"},],"Person":[{"name":"name","type":"string"},{"name":"wallet","type":"address"},],},"primaryType":"Person","message":{"name":"JohnDoe","wallet":"0x1234567890123456789012345678901234567890",},}signed_typed_data=account.sign_typed_data(full_message=typed_data,)print("Signedtypeddata:",signed_typed_data)#4.Signatransactionw3=Web3(Web3.HTTPProvider("https://sepolia.base.org"))nonce=w3.eth.get_transaction_count(account.address)transaction=account.sign_transaction(transaction_dict={"to":"0x000000000000000000000000000000000000dEaD","value":10000000000,"chainId":84532,"gas":21000,"maxFeePerGas":1000000000,"maxPriorityFeePerGas":1000000000,"nonce":nonce,"type":"0x2",})print("Signedtransaction:",transaction)awaitcdp.close()asyncio.run(main())```##SendTransactionExampleOnceyouhavesignedyourtransaction,youcanuse[web3](https://web3py.readthedocs.io/en/stable/)tosendit.Here'sanexample:```pythonmain.py[expandable]lineswrapimportasynciofromcdpimportCdpClientfromcdp.evm_local_accountimportEvmLocalAccountfromweb3importWeb3importdotenvdotenv.load_dotenv()asyncdefmain():cdp=CdpClient()server_account=awaitcdp.evm.create_account()print(f"Successfullycreatedaccount:{server_account.address}")account=EvmLocalAccount(server_account)w3=Web3(Web3.HTTPProvider("https://sepolia.base.org"))nonce=w3.eth.get_transaction_count(account.address)transaction=account.sign_transaction(transaction_dict={"to":"0x000000000000000000000000000000000000dEaD","value":10000000000,"chainId":84532,"gas":21000,"maxFeePerGas":1000000000,"maxPriorityFeePerGas":1000000000,"nonce":nonce,"type":"0x2",})print("Signedtransaction:",transaction)print("\nRequestingETHfromfaucetforaccount...")faucet_hash=awaitcdp.evm.request_faucet(address=account.address,network="base-sepolia",token="eth")w3.eth.wait_for_transaction_receipt(faucet_hash)print("Receivedfundsfromfaucet...")tx_hash=w3.eth.send_raw_transaction(transaction.raw_transaction)print(f"Transactionsent!Hash:{tx_hash.hex()}")awaitcdp.close()asyncio.run(main())```